(this["webpackJsonpenglish-fight-ui"]=this["webpackJsonpenglish-fight-ui"]||[]).push([[0],{351:function(e,t,n){},352:function(e,t,n){},369:function(e,t,n){},370:function(e,t,n){},372:function(e,t,n){},377:function(e,t,n){"use strict";n.r(t);n(246),n(272),n(274),n(275),n(277),n(278),n(279),n(280),n(281),n(282),n(283),n(284),n(286),n(287),n(288),n(289),n(290),n(291),n(292),n(293),n(294),n(295),n(297),n(298),n(299),n(300),n(301),n(302),n(303),n(304),n(305),n(306),n(307),n(308),n(309),n(310),n(311),n(312),n(313),n(314);var r=n(2),a=n(0),c=n.n(a),i=n(170),o=n(58),s=n.n(o),u=n(6),l=n.n(u),d=n(12),b=n(20),j=n(182),f=n.n(j),p=n(184),h=n.n(p),O=(n(324),n(21)),v=n(48),x=n(171),m=n(127),k=n(172),w=n.n(k),y=function(){function e(){Object(O.a)(this,e)}return Object(v.a)(e,null,[{key:"post",value:function(){var t=Object(d.a)(l.a.mark((function t(n,r){var a,c,i,o,s,u,d,b=arguments;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=b.length>2&&void 0!==b[2]?b[2]:{},c=a.sendToken,i=void 0===c||c,o=a.expand,s=void 0===o?"":o,u=a.Model,d=void 0===u?null:u,t.abrupt("return",e.send(n,{data:e.convertDataToBackendFormat(r),sendToken:i,method:"POST",expand:s,Model:d}));case 2:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"patch",value:function(){var t=Object(d.a)(l.a.mark((function t(n,r){var a,c,i,o,s,u,d,b=arguments;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=b.length>2&&void 0!==b[2]?b[2]:{},c=a.sendToken,i=void 0===c||c,o=a.expand,s=void 0===o?"":o,u=a.Model,d=void 0===u?null:u,t.abrupt("return",e.send(n,{data:e.convertDataToBackendFormat(r),sendToken:i,method:"PATCH",expand:s,Model:d}));case 2:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"get",value:function(){var t=Object(d.a)(l.a.mark((function t(n){var r,a,c,i,o,s=arguments;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=s.length>1&&void 0!==s[1]?s[1]:{},a=r.expand,c=void 0===a?"":a,i=r.Model,o=void 0===i?null:i,t.abrupt("return",e.send(n,{sendToken:!0,method:"GET",expand:c,Model:o}));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"send",value:function(){var t=Object(d.a)(l.a.mark((function t(n,r){var a,c,i,o,s,u,d,b,j,f;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=r.data,c=r.sendToken,i=r.method,o=r.expand,s=r.Model,u=void 0===s?null:s,d=new URLSearchParams,o&&(b=w()(o).join(","),d.append("expand",b)),j={headers:e.createHeaders({sendToken:c})},"GET"!==i&&(j.mode="cors",j.body=JSON.stringify(a)),j.method=i,t.next=8,Object(x.timeout)(fetch(e.createFullUrl(n,d),j),1e4);case 8:return f=t.sent,t.abrupt("return",e.processResponse(f,u));case 10:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"createHeaders",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.sendToken,r={Accept:"application/json","Content-Type":"application/json"};return n&&(r.Authorization=e.getAuthorizationHeader()),r}},{key:"getAuthorizationHeader",value:function(){var e=window.location.search.slice(1);return"QueryString ".concat(e)}},{key:"createFullUrl",value:function(t,n){var r=e.removeTrailingSlash("https://enfight.tmweb.ru/api"),a="".concat(r,"/").concat(t);return n&&String(n)&&(a+="?".concat(String(n))),a}},{key:"processResponse",value:function(){var t=Object(d.a)(l.a.mark((function t(n){var r,a,c=arguments;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=c.length>1&&void 0!==c[1]?c[1]:null,!(n.status>=500&&n.status<600)){t.next=3;break}throw new Error("\u0412\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u044f\u044f \u043e\u0448\u0438\u0431\u043a\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430");case 3:return t.prev=3,t.next=6,n.json();case 6:a=t.sent,t.next=12;break;case 9:throw t.prev=9,t.t0=t.catch(3),new Error("\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u043e\u0442\u0432\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u0430");case 12:if(n.ok){t.next=16;break}if(!a.detail){t.next=15;break}throw new Error(a.detail);case 15:throw new Error("\u041d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f");case 16:return t.abrupt("return",e.convertDataToFrontendFormat(a,r));case 17:case"end":return t.stop()}}),t,null,[[3,9]])})));return function(e){return t.apply(this,arguments)}}()},{key:"convertDataToBackendFormat",value:function(e){return Object(m.toSnake)(e)}},{key:"convertDataToFrontendFormat",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=Object(m.toCamel)(e);return t?t.fromObject(n):n}},{key:"removeTrailingSlash",value:function(e){return e.endsWith("/")?e.slice(0,-1):e}}]),e}(),g=n(65),S=n(64),N=n(95),B=n(173),T=n.n(B),E=n(13),C=n.n(E);function U(e){return function(t){return T()(t,e)}}function P(e,t){return this.constructor.update(this,Object(N.a)({},e,{$set:t}))}function A(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Object(E.struct)(e,{name:t,defaultProps:n});return r.fromObject=U(r),r.prototype.set=P,r}var q=Object(E.irreducible)("Null",(function(e){return null===e})),M=Object(E.refinement)(C.a.Number,(function(e){return e>=0}),"PositiveNumber"),F=Object(E.refinement)(C.a.Number,(function(e){return e>=1}),"ID"),Q={ALLOW:"allow",BLOCK:"block",TO_BE_REQUESTED:"to be requested"},_=function(e){Object(g.a)(n,e);var t=Object(S.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return n}(A({id:F,vkId:F,firstName:C.a.String,lastName:C.a.String,photoUrl:C.a.String,score:M,foreverRank:M,monthlyRank:M,notificationsStatus:C.a.enums.of(Object.values(Q),"notificationsStatus")},"User")),R=function(){function e(){Object(O.a)(this,e)}return Object(v.a)(e,null,[{key:"waitForTimeout",value:function(){var e=Object(d.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){return setTimeout(e,t)}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getSearchParam",value:function(e){return new URLSearchParams(window.location.search).get(e)}}]),e}();R.isProductionMode=!0;var L=function(){function e(){Object(O.a)(this,e)}return Object(v.a)(e,[{key:"init",value:function(){console.log("Init tracker")}},{key:"reachGoal",value:function(){var e=Object(d.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Reach goal ".concat(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),z=function(){function e(){Object(O.a)(this,e)}return Object(v.a)(e,[{key:"init",value:function(){var e,t,n,r,a;e=window,t=document,n="script",e.ym=e.ym||function(){(e.ym.a=e.ym.a||[]).push(arguments)},e.ym.l=1*new Date,r=t.createElement(n),a=t.getElementsByTagName(n)[0],r.async=1,r.src="https://mc.yandex.ru/metrika/tag.js",a.parentNode.insertBefore(r,a);try{ym(70656700,"init",{clickmap:!0,trackLinks:!0,accurateTrackBounce:!0,webvisor:!0})}catch(t){console.log("Seems like Yandex metrika is blocked"),console.warn(t)}}},{key:"reachGoal",value:function(e){return new Promise((function(t){try{window.ym(70656700,"reachGoal",e,(function(){return t()}))}catch(n){console.log("Seems like Yandex metrika is blocked"),console.warn(n)}}))}}]),e}(),G=new(R.isProductionMode?z:L),D=!1;function W(e){if(!D)throw new Error("Tracker was not initialized");G.reachGoal(e)}var I=function(){function e(){Object(O.a)(this,e)}return Object(v.a)(e,null,[{key:"fetchUserData",value:function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",y.get("user",{Model:_}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"allowNotifications",value:function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return W("allow-notifications"),e.abrupt("return",y.patch("user",{notificationsStatus:Q.ALLOW},{Model:_}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"blockNotifications",value:function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return W("block-notifications"),e.abrupt("return",y.patch("user",{notificationsStatus:Q.BLOCK},{Model:_}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"requestNotifications",value:function(){var t=Object(d.a)(l.a.mark((function t(){var n;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.areNotificationsEnabledOnVkSide){t.next=2;break}return t.abrupt("return",e.allowNotifications());case 2:return t.prev=2,t.next=5,s.a.send("VKWebAppAllowNotifications");case 5:if(n=t.sent,!n.result){t.next=9;break}return t.abrupt("return",e.allowNotifications());case 9:t.next=16;break;case 11:if(t.prev=11,t.t0=t.catch(2),"client_error"!==t.t0.error_type||!t.t0.error_data||4!==t.t0.error_data.error_code||"User denied"!==t.t0.error_data.error_reason){t.next=15;break}return t.abrupt("return",e.blockNotifications());case 15:throw t.t0;case 16:case"end":return t.stop()}}),t,null,[[2,11]])})));return function(){return t.apply(this,arguments)}}()}]),e}();I.areNotificationsEnabledOnVkSide=Boolean(parseInt(R.getSearchParam("vk_are_notifications_enabled"),10));n(351);var H=n(379),K=(n(352),n(10)),V=function(e){Object(g.a)(n,e);var t=Object(S.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return n}(A({id:F,questionWord:C.a.String,answerWords:C.a.list(C.a.String),correctAnswer:C.a.union([q,C.a.String]),selectedAnswer:C.a.union([q,C.a.String]),isCorrect:C.a.Boolean},"Question")),J=C.a.union([V,C.a.Number]);J.dispatch=function(e){return"number"===typeof e?C.a.Number:V};var Y=function(e){Object(g.a)(n,e);var t=Object(S.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return n}(A({id:F,questions:C.a.list(J),points:C.a.Number},"Game")),$=function(){function e(){Object(O.a)(this,e)}return Object(v.a)(e,null,[{key:"startBattle",value:function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",y.post("game",{},{expand:"questions",Model:Y}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"submitQuestion",value:function(){var e=Object(d.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",y.patch("question/".concat(t.id),{selectedAnswer:t.selectedAnswer},{Model:V}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getBattle",value:function(){var e=Object(d.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",y.get("game/".concat(t),{expand:"questions",Model:Y}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),X=n(49),Z=n.n(X),ee=n(74),te=n.n(ee),ne=n(71),re=n.n(ne),ae=n(96),ce=n.n(ae),ie=n(177),oe=n.n(ie),se=n(33),ue=n(176),le=n.n(ue),de=n(175),be=n.n(de);var je=function(){return Object(K.v)()===K.i?Object(r.jsx)(be.a,{}):Object(r.jsx)(le.a,{})};function fe(e){var t=e.panelHeaderProps,n=e.onBackButtonClick,a=e.text,c=e.showBackButton,i=Object(se.a)({},t);return i.left=c?Object(r.jsx)(K.m,{onClick:n,children:Object(r.jsx)(je,{})}):void 0,Object(r.jsx)(K.l,Object(se.a)(Object(se.a)({},i),{},{children:a}))}fe.defaultProps={panelHeaderProps:{},showBackButton:!0,onBackButtonClick:function(){}};var pe=n(22),he=n.n(pe);function Oe(e){var t=e.delay,n=e.render,r=Object(a.useState)(!1),c=Object(b.a)(r,2),i=c[0],o=c[1];return Object(a.useEffect)((function(){var e=setTimeout((function(){o(!0)}),t);return function(){clearTimeout(e)}}),[t]),i?n():null}Oe.propTypes={delay:he.a.number,render:he.a.func},Oe.defaultProps={delay:200,render:function(){return Object(r.jsx)(K.n,{size:"large"})}};var ve=Oe,xe=function(e){var t=e.onStartBattle,n=e.user,c=e.onUpdateUser,i=Object(a.useState)(!1),o=Object(b.a)(i,2),s=o[0],u=o[1],j=function(){var e=Object(d.a)(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.target.checked,u(!0),e.prev=2,!n){e.next=9;break}return e.next=6,I.requestNotifications();case 6:r=e.sent,e.next=12;break;case 9:return e.next=11,I.blockNotifications();case 11:r=e.sent;case 12:c(r);case 13:return e.prev=13,u(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[2,,13,16]])})));return function(t){return e.apply(this,arguments)}}();return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(fe,{text:"English Clash",showBackButton:!1}),n&&Object(r.jsx)(te.a,{children:Object(r.jsx)(re.a,{before:n.photoUrl?Object(r.jsx)(oe.a,{src:n.photoUrl}):null,description:Object(r.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[Object(r.jsxs)("span",{children:["\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043e\u0447\u043a\u043e\u0432 - ",n.score]})," ",Object(r.jsxs)("span",{children:["\u041c\u0435\u0441\u0442\u043e \u0432 \u0440\u0435\u0439\u0442\u0438\u043d\u0433\u0435: ",n.foreverRank]})]}),multiline:!0,children:"".concat(n.firstName," ").concat(n.lastName)})}),Object(r.jsx)(te.a,{children:Object(r.jsx)(ce.a,{children:Object(r.jsx)(Z.a,{size:"xl",onClick:t,disabled:s,children:"\u041d\u0430\u0447\u0430\u0442\u044c!"})})}),n&&Object(r.jsx)(te.a,{children:Object(r.jsx)(re.a,{multiline:!0,indicator:Object(r.jsx)(K.p,{checked:n.notificationsStatus===Q.ALLOW,onChange:j,disabled:s}),children:"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f \u043e\u0431 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f\u0445"})}),s&&Object(r.jsx)(ve,{})]})};xe.defaultProps={user:null};var me=xe,ke=(n(369),n(178));function we(e){var t=e.questionWord,n=e.answerWords,a=e.selectedAnswer,c=e.isCorrect,i=e.correctAnswer,o=e.onSelectAnswer;return Object(r.jsxs)(ce.a,{children:[Object(r.jsxs)("p",{children:["\u0421\u043b\u043e\u0432\u043e \u043d\u0430 \u0430\u043d\u0433\u043b\u0438\u0439\u0441\u043a\u043e\u043c: ",t]}),Object(r.jsx)("p",{children:" \u0412\u044b\u0431\u0435\u0440\u0438 \u0435\u0433\u043e \u043f\u0435\u0440\u0435\u0432\u043e\u0434 \u043d\u0430 \u0440\u0443\u0441\u0441\u043a\u0438\u0439:"}),n.map((function(e){var t=e===i,n=!c&&e===a,s=Object(ke.a)("answer-button",{correct:t,failure:n});return Object(r.jsx)(Z.a,{size:"xl",mode:"primary",stretched:!0,className:s,onClick:function(){return!a&&o(e)},children:e},e)}))]})}we.defaultProps={correctAnswer:null,selectedAnswer:null,isCorrect:!1};var ye=we,ge=n(129),Se="setBattle",Ne="updateQuestion",Be="goToNextQuestion",Te={battle:null,activeQuestion:null,hasNextQuestion:!1};function Ee(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Te,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Se:var n=t.payload,r=n.questions;return Object(se.a)(Object(se.a)({},e),{},{battle:n,activeQuestion:r[0],hasNextQuestion:r.length>1});case Ne:var a=t.payload,c=e.battle.questions,i=c.findIndex((function(e){return e.id===a.id})),o=[].concat(Object(ge.a)(c.slice(0,i)),[a],Object(ge.a)(c.slice(i+1)));return Object(se.a)(Object(se.a)({},e),{},{battle:Object(se.a)(Object(se.a)({},e.battle),{},{questions:o}),activeQuestion:a});case Be:var s=e.battle.questions,u=s.findIndex((function(t){return t.id===e.activeQuestion.id}));if(u===s.length-1)throw new Error("\u0412\u044b \u0443\u0436\u0435 \u043d\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u043c \u0432\u043e\u043f\u0440\u043e\u0441\u0435");var l=u+1;return Object(se.a)(Object(se.a)({},e),{},{activeQuestion:s[l],hasNextQuestion:l<s.length-1});default:return e}}var Ce=function(e){var t=e.onGoBack,n=e.onFinishGame,c=Object(a.useState)(!1),i=Object(b.a)(c,2),o=i[0],s=i[1],u=Object(a.useReducer)(Ee,Te),j=Object(b.a)(u,2),f=j[0],p=j[1],h=f.battle,O=f.activeQuestion,v=f.hasNextQuestion;Object(a.useEffect)((function(){(function(){var e=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s(!0),e.prev=1,e.next=4,$.startBattle();case 4:t=e.sent,p({type:Se,payload:t});case 6:return e.prev=6,s(!1),e.finish(6);case 9:case"end":return e.stop()}}),e,null,[[1,,6,9]])})));return function(){return e.apply(this,arguments)}})()()}),[]);var x=function(){var e=Object(d.a)(l.a.mark((function e(t){var r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=O.set("selectedAnswer",t),s(!0),e.prev=2,e.next=5,$.submitQuestion(r);case 5:a=e.sent,p({type:Ne,payload:a});case 7:return e.prev=7,s(!1),e.finish(7);case 10:return e.next=12,R.waitForTimeout(1e3);case 12:v?p({type:Be}):n(h);case 13:case"end":return e.stop()}}),e,null,[[2,,7,10]])})));return function(t){return e.apply(this,arguments)}}();return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(fe,{onBackButtonClick:t,text:"\u0418\u0433\u0440\u0430"}),O&&Object(r.jsx)(ye,Object(se.a)(Object(se.a)({},O),{},{onSelectAnswer:x})),o&&Object(r.jsx)(ve,{})]})};Ce.defaultProps={user:null};var Ue=Ce,Pe=n(99),Ae=n.n(Pe),qe=n(181),Me=n.n(qe),Fe=(n(370),n(179)),Qe=n.n(Fe),_e=n(180),Re=n.n(_e);function Le(e){var t=e.user,n=e.onGoBack,c=e.battle,i=e.onRetry,o=e.onUpdateUser,s=c.questions,u=c.points,j=s.filter((function(e){return e.isCorrect})).length,f=s.length-j,p=Object(a.useState)(!1),h=Object(b.a)(p,2),O=h[0],v=h[1],x=Object(a.useState)(!1),m=Object(b.a)(x,2),k=m[0],w=m[1],y=t.notificationsStatus===Q.TO_BE_REQUESTED,g=Object(r.jsxs)("div",{className:"action-buttons-wrapper",children:[Object(r.jsx)(Z.a,{onClick:n,size:"l",before:Object(r.jsx)(Qe.a,{}),children:"\u0414\u043e\u043c\u043e\u0439"}),Object(r.jsx)(Z.a,{onClick:i,size:"l",before:Object(r.jsx)(Re.a,{}),children:"\u0415\u0449\u0435 \u0440\u0430\u0437"})]}),S=Object(r.jsx)(K.c,{style:{marginTop:"10px"},children:Object(r.jsx)(K.b,{size:"l",style:{padding:"10px"},children:Object(r.jsxs)("div",{className:"notification-request-content",children:[Object(r.jsx)("span",{className:"notification-request-header",children:"\u0423\u0437\u043d\u0430\u0439 \u043f\u0435\u0440\u0432\u044b\u043c \u043e\u0431 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f\u0445 - \u043f\u043e\u0434\u043f\u0438\u0448\u0438\u0441\u044c \u043d\u0430 \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f!"}),Object(r.jsxs)("div",{className:"notification-buttons-wrapper",children:[Object(r.jsx)(Z.a,{size:"m",mode:"commerce",className:"notification-button",onClick:Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return w(!0),e.prev=1,e.next=4,I.requestNotifications();case 4:t=e.sent,o(t),t.notificationsStatus===Q.BLOCK&&v(!0);case 7:return e.prev=7,w(!1),e.finish(7);case 10:case"end":return e.stop()}}),e,null,[[1,,7,10]])}))),disabled:k,children:"\u041f\u043e\u0434\u043f\u0438\u0441\u0430\u0442\u044c\u0441\u044f"}),Object(r.jsx)(Z.a,{size:"m",mode:"secondary",className:"notification-button",onClick:Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return w(!0),e.t0=o,e.next=4,I.blockNotifications();case 4:e.t1=e.sent,(0,e.t0)(e.t1),w(!1),v(!0);case 8:case"end":return e.stop()}}),e)}))),disabled:k,children:"\u041d\u0435 \u0441\u0435\u0439\u0447\u0430\u0441"})]}),Object(r.jsx)("span",{className:"notification-request-subtext",children:"\u0412\u0441\u0435\u0433\u0434\u0430 \u043c\u043e\u0436\u043d\u043e \u043e\u0442\u043f\u0438\u0441\u0430\u0442\u044c\u0441\u044f \u043d\u0430 \u0433\u043b\u0430\u0432\u043d\u043e\u043c \u044d\u043a\u0440\u0430\u043d\u0435"})]})})});return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(fe,{text:"\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b",onBackButtonClick:n}),Object(r.jsxs)(te.a,{header:Object(r.jsx)(Me.a,{mode:"secondary",children:"\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430"}),children:[Object(r.jsx)(re.a,{indicator:Object(r.jsx)(Ae.a,{mode:"primary",children:j}),children:"\u0412\u0435\u0440\u043d\u044b\u0445 \u043e\u0442\u0432\u0435\u0442\u043e\u0432:"}),Object(r.jsx)(re.a,{indicator:Object(r.jsx)(Ae.a,{mode:"primary",children:f}),children:"\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0445 \u043e\u0442\u0432\u0435\u0442\u043e\u0432:"}),Object(r.jsx)(re.a,{indicator:Object(r.jsx)(Ae.a,{mode:"primary",children:u}),children:"\u041f\u043e\u043b\u0443\u0447\u0435\u043d\u043e \u043e\u0447\u043a\u043e\u0432:"})]}),!y&&g,y&&S,O&&Object(r.jsx)(K.e,{className:"subscribe-later",children:"\u041f\u043e\u0434\u043f\u0438\u0441\u0430\u0442\u044c\u0441\u044f \u043c\u043e\u0436\u043d\u043e \u043d\u0430 \u0433\u043b\u0430\u0432\u043d\u043e\u043c \u044d\u043a\u0440\u0430\u043d\u0435"}),k&&Object(r.jsx)(ve,{})]})}Le.defaultProps={user:null,battle:null};var ze=Le,Ge=n(385),De=n(386),We=function(e){Object(g.a)(n,e);var t=Object(S.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return n}(A({id:F,firstName:C.a.String,lastName:C.a.String,photoUrl:C.a.String,score:M},"ScoreboardUser"));n(372);var Ie=function(e){var t=e.rank,n=e.score,a=e.photoUrl,c=e.firstName,i=e.lastName;return Object(r.jsx)(K.o,{before:Object(r.jsx)(K.d,{children:t}),after:n,children:Object(r.jsxs)("div",{className:"scoreboard-item",children:[Object(r.jsx)(K.a,{size:40,src:a}),Object(r.jsxs)("div",{className:"scoreboard-item-name",children:[c," ",i]})]})})},He="forever",Ke="monthly";function Ve(e){var t=e.user,n=Object(a.useState)([]),c=Object(b.a)(n,2),i=c[0],o=c[1],s=Object(a.useState)(!1),u=Object(b.a)(s,2),j=u[0],f=u[1],p=Object(a.useState)(He),h=Object(b.a)(p,2),O=h[0],v=h[1],x=Object(a.useState)(!1),m=Object(b.a)(x,2),k=m[0],w=m[1];return Object(a.useEffect)((function(){(function(){var e=Object(d.a)(l.a.mark((function e(){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o([]),f(!0),e.next=4,y.get("".concat(O,"_scoreboard"));case 4:n=e.sent,r=We.fromObject(t),w(Boolean(n.find((function(e){return e.id===r.id})))),o(n),f(!1);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[O,t]),Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(fe,{text:"\u0420\u0435\u0439\u0442\u0438\u043d\u0433",showBackButton:!1}),Object(r.jsx)(K.g,{vertical:"top",children:Object(r.jsxs)(K.s,{children:[Object(r.jsx)(K.t,{selected:O===He,onClick:function(){return v(He)},children:"\u0417\u0430 \u0432\u0441\u0435 \u0432\u0440\u0435\u043c\u044f"}),Object(r.jsx)(K.t,{selected:O===Ke,onClick:function(){return v(Ke)},children:"\u0417\u0430 \u043c\u0435\u0441\u044f\u0446"})]})}),Object(r.jsx)(K.e,{children:Object(r.jsxs)(K.h,{style:{paddingTop:"20px"},children:[!j&&Object(r.jsxs)(K.j,{children:[i.map((function(e,t){var n=e.id,a=e.firstName,c=e.lastName,i=e.photoUrl,o=e.score;return Object(r.jsx)(Ie,{rank:t+1,score:o,photoUrl:i,firstName:a,lastName:c},n)})),!k&&Object(r.jsx)(Ie,{rank:O===He?t.foreverRank:t.monthlyRank,score:t.score,photoUrl:t.photoUrl,firstName:t.firstName,lastName:t.lastName})]}),j&&Object(r.jsx)(ve,{})]})})]})}Ve.defaultProps={user:null};var Je=Ve,Ye=function(){var e=Object(a.useState)(null),t=Object(b.a)(e,2),n=t[0],c=t[1],i=Object(a.useState)(Object(r.jsx)(f.a,{})),o=Object(b.a)(i,2),s=o[0],u=o[1],j=Object(a.useState)("game"),p=Object(b.a)(j,2),O=p[0],v=p[1],x=Object(a.useState)("home"),m=Object(b.a)(x,2),k=m[0],w=m[1],y=Object(a.useState)(null),g=Object(b.a)(y,2),S=g[0],N=g[1];function B(e){return T.apply(this,arguments)}function T(){return(T=Object(d.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,I.fetchUserData();case 3:if(n=e.sent,c(n),!t){e.next=12;break}if(n.notificationsStatus!==Q.ALLOW||I.areNotificationsEnabledOnVkSide){e.next=12;break}return e.t0=c,e.next=10,I.blockNotifications();case 10:e.t1=e.sent,(0,e.t0)(e.t1);case 12:return e.prev=12,u(null),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[0,,12,15]])})))).apply(this,arguments)}Object(a.useEffect)((function(){R.isProductionMode&&H.a({dsn:"https://ae49049c58d94887bed337d523675ca6@o158161.ingest.sentry.io/5554359",beforeSend:function(e,t){if(e.exception){var n=t&&t.originalException&&t.originalException instanceof Error&&t.originalException.message?t.originalException.message:"";u(Object(r.jsxs)(h.a,{actions:[{mode:"default",title:"\u041e\u041a",autoclose:!0}],onClose:function(){return u(null)},children:[Object(r.jsx)("h2",{children:"\u0412\u043e\u0437\u043d\u0438\u043a\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430 =("}),n&&Object(r.jsx)("p",{className:"error-message",children:n}),Object(r.jsx)("p",{children:"\u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439 \u0435\u0449\u0435 \u0440\u0430\u0437"})]}))}return e}}),D||(G.init(),D=!0)}),[]),Object(a.useEffect)((function(){B(!0)}),[]);var E=function(){var e=Object(d.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$.getBattle(t.id);case 2:n=e.sent,N(n),w("results"),W("finish-game"),B(!1);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),C=function(){return w("home")},U=function(){w("battle"),W("start-game")};return Object(r.jsxs)(K.f,{activeStory:O,tabbar:Object(r.jsxs)(K.q,{children:[Object(r.jsx)(K.r,{text:"\u0413\u043b\u0430\u0432\u043d\u0430\u044f",selected:"game"===O,onClick:function(){v("game"),w("home")},children:Object(r.jsx)(Ge.a,{})}),Object(r.jsx)(K.r,{text:"\u0420\u0435\u0439\u0442\u0438\u043d\u0433",selected:"scoreboard"===O,onClick:function(){v("scoreboard"),w("scoreboard-home")},children:Object(r.jsx)(De.a,{})})]}),children:[Object(r.jsxs)(K.u,{id:"game",activePanel:k,popout:s,children:[Object(r.jsx)(K.k,{id:"home",children:Object(r.jsx)(me,{user:n,onStartBattle:U,onUpdateUser:function(e){return c(e)}})}),Object(r.jsx)(K.k,{id:"battle",children:Object(r.jsx)(Ue,{onGoBack:C,user:n,onFinishGame:E})}),Object(r.jsx)(K.k,{id:"results",children:Object(r.jsx)(ze,{user:n,onRetry:U,onGoBack:C,battle:S,onUpdateUser:function(e){return c(e)}})})]}),Object(r.jsx)(K.u,{id:"scoreboard",activePanel:k,popout:s,children:Object(r.jsx)(K.k,{id:"scoreboard-home",children:Object(r.jsx)(Je,{user:n})})})]})},$e=n(387);function Xe(e){var t=e.children;return R.isProductionMode?Object(r.jsx)($e.a,{fallback:function(e){var t=e.error,n=e.componentStack,a=e.resetError;return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)("div",{children:"\u041e\u0448\u0438\u0431\u043a\u0430 \u043e\u0442\u0440\u0438\u0441\u043e\u0432\u043a\u0438:"}),Object(r.jsx)("p",{children:t.message}),Object(r.jsx)("p",{children:n}),Object(r.jsx)(Z.a,{onClick:a,children:"\u041f\u043e\u043f\u0440\u043e\u0431\u043e\u0432\u0430\u0442\u044c \u0435\u0449\u0435 \u0440\u0430\u0437"})]})},children:t}):t}s.a.send("VKWebAppInit"),s.a.subscribe((function(e){var t=e.detail,n=t.type,r=t.data;if("VKWebAppUpdateConfig"===n){var a=document.createAttribute("scheme");a.value=r.scheme||"client_light",document.body.attributes.setNamedItem(a)}})),Object(i.render)(Object(r.jsx)(c.a.StrictMode,{children:Object(r.jsx)(Xe,{children:Object(r.jsx)(Ye,{})})}),document.getElementById("root")),R.isProductionMode||Promise.all([n.e(3),n.e(4)]).then(n.bind(null,391))}},[[377,1,2]]]);
//# sourceMappingURL=main.90341a3c.chunk.js.map