(this["webpackJsonpenglish-fight-ui"]=this["webpackJsonpenglish-fight-ui"]||[]).push([[0],{350:function(e,t,n){},351:function(e,t,n){},368:function(e,t,n){},369:function(e,t,n){},371:function(e,t,n){},372:function(e,t,n){},377:function(e,t,n){"use strict";n.r(t);n(245),n(271),n(273),n(274),n(276),n(277),n(278),n(279),n(280),n(281),n(282),n(283),n(285),n(286),n(287),n(288),n(289),n(290),n(291),n(292),n(293),n(294),n(296),n(297),n(298),n(299),n(300),n(301),n(302),n(303),n(304),n(305),n(306),n(307),n(308),n(309),n(310),n(311),n(312),n(313);var r=n(1),a=n(0),c=n.n(a),i=n(170),o=n(58),s=n.n(o),u=n(6),l=n.n(u),d=n(12),j=n(20),b=n(182),f=n.n(b),p=n(184),h=n.n(p),O=(n(323),n(21)),x=n(43),v=n(171),m=n(127),k=n(172),y=n.n(k),w=function(){function e(){Object(O.a)(this,e)}return Object(x.a)(e,null,[{key:"post",value:function(){var t=Object(d.a)(l.a.mark((function t(n,r){var a,c,i,o,s,u,d,j=arguments;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=j.length>2&&void 0!==j[2]?j[2]:{},c=a.sendToken,i=void 0===c||c,o=a.expand,s=void 0===o?"":o,u=a.Model,d=void 0===u?null:u,t.abrupt("return",e.send(n,{data:e.convertDataToBackendFormat(r),sendToken:i,method:"POST",expand:s,Model:d}));case 2:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"patch",value:function(){var t=Object(d.a)(l.a.mark((function t(n,r){var a,c,i,o,s,u,d,j=arguments;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=j.length>2&&void 0!==j[2]?j[2]:{},c=a.sendToken,i=void 0===c||c,o=a.expand,s=void 0===o?"":o,u=a.Model,d=void 0===u?null:u,t.abrupt("return",e.send(n,{data:e.convertDataToBackendFormat(r),sendToken:i,method:"PATCH",expand:s,Model:d}));case 2:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"get",value:function(){var t=Object(d.a)(l.a.mark((function t(n){var r,a,c,i,o,s=arguments;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=s.length>1&&void 0!==s[1]?s[1]:{},a=r.expand,c=void 0===a?"":a,i=r.Model,o=void 0===i?null:i,t.abrupt("return",e.send(n,{sendToken:!0,method:"GET",expand:c,Model:o}));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"send",value:function(){var t=Object(d.a)(l.a.mark((function t(n,r){var a,c,i,o,s,u,d,j,b,f;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=r.data,c=r.sendToken,i=r.method,o=r.expand,s=r.Model,u=void 0===s?null:s,d=new URLSearchParams,o&&(j=y()(o).join(","),d.append("expand",j)),b={headers:e.createHeaders({sendToken:c})},"GET"!==i&&(b.mode="cors",b.body=JSON.stringify(a)),b.method=i,t.next=8,Object(v.timeout)(fetch(e.createFullApiURL(n,d),b),1e4);case 8:return f=t.sent,t.abrupt("return",e.processResponse(f,u));case 10:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"createHeaders",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.sendToken,r={Accept:"application/json","Content-Type":"application/json"};return n&&(r.Authorization=e.getAuthorizationHeader()),r}},{key:"getAuthorizationHeader",value:function(){var e=window.location.search.slice(1);return"QueryString ".concat(e)}},{key:"createFullApiURL",value:function(t,n){return e.createFullUrl("api/".concat(t),n)}},{key:"createFullUrl",value:function(t,n){var r=e.removeTrailingSlash("https://enfight.tmweb.ru"),a="".concat(r,"/").concat(t);return n&&String(n)&&(a+="?".concat(String(n))),a}},{key:"processResponse",value:function(){var t=Object(d.a)(l.a.mark((function t(n){var r,a,c=arguments;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=c.length>1&&void 0!==c[1]?c[1]:null,!(n.status>=500&&n.status<600)){t.next=3;break}throw new Error("\u0412\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u044f\u044f \u043e\u0448\u0438\u0431\u043a\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430");case 3:return t.prev=3,t.next=6,n.json();case 6:a=t.sent,t.next=12;break;case 9:throw t.prev=9,t.t0=t.catch(3),new Error("\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u043e\u0442\u0432\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u0430");case 12:if(n.ok){t.next=16;break}if(!a.detail){t.next=15;break}throw new Error(a.detail);case 15:throw new Error("\u041d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f");case 16:return t.abrupt("return",e.convertDataToFrontendFormat(a,r));case 17:case"end":return t.stop()}}),t,null,[[3,9]])})));return function(e){return t.apply(this,arguments)}}()},{key:"convertDataToBackendFormat",value:function(e){return Object(m.toSnake)(e)}},{key:"convertDataToFrontendFormat",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=Object(m.toCamel)(e);return t?t.fromObject(n):n}},{key:"removeTrailingSlash",value:function(e){return e.endsWith("/")?e.slice(0,-1):e}}]),e}(),g=n(66),S=n(65),N=n(72),B=n(173),T=n.n(B),C=n(13),E=n.n(C);function U(e){return function(t){return T()(t,e)}}function P(e,t){return this.constructor.update(this,Object(N.a)({},e,{$set:t}))}function A(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Object(C.struct)(e,{name:t,defaultProps:n});return r.fromObject=U(r),r.prototype.set=P,r}var F=Object(C.irreducible)("Null",(function(e){return null===e})),q=Object(C.refinement)(E.a.Number,(function(e){return e>=0}),"PositiveNumber"),M=Object(C.refinement)(E.a.Number,(function(e){return e>=1}),"ID"),Q={ALLOW:"allow",BLOCK:"block",TO_BE_REQUESTED:"to be requested"},R="word",L="picture",_=function(e){Object(g.a)(n,e);var t=Object(S.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return n}(A({id:M,vkId:M,firstName:E.a.String,lastName:E.a.String,photoUrl:E.a.String,score:q,foreverRank:q,monthlyRank:q,notificationsStatus:E.a.enums.of(Object.values(Q),"notificationsStatus")},"User")),z=function(){function e(){Object(O.a)(this,e)}return Object(x.a)(e,null,[{key:"waitForTimeout",value:function(){var e=Object(d.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){return setTimeout(e,t)}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getSearchParam",value:function(e){return new URLSearchParams(window.location.search).get(e)}}]),e}();z.isProductionMode=!0;var G=function(){function e(){Object(O.a)(this,e)}return Object(x.a)(e,[{key:"init",value:function(){console.log("Init tracker")}},{key:"reachGoal",value:function(){var e=Object(d.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Reach goal ".concat(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),D=function(){function e(){Object(O.a)(this,e)}return Object(x.a)(e,[{key:"init",value:function(){var e,t,n,r,a;e=window,t=document,n="script",e.ym=e.ym||function(){(e.ym.a=e.ym.a||[]).push(arguments)},e.ym.l=1*new Date,r=t.createElement(n),a=t.getElementsByTagName(n)[0],r.async=1,r.src="https://mc.yandex.ru/metrika/tag.js",a.parentNode.insertBefore(r,a);try{ym(70656700,"init",{clickmap:!0,trackLinks:!0,accurateTrackBounce:!0,webvisor:!0})}catch(t){console.log("Seems like Yandex metrika is blocked"),console.warn(t)}}},{key:"reachGoal",value:function(e){return new Promise((function(t){try{window.ym(70656700,"reachGoal",e,(function(){return t()}))}catch(n){console.log("Seems like Yandex metrika is blocked"),console.warn(n)}}))}}]),e}(),W=new(z.isProductionMode?D:G),I=!1;function H(e){if(!I)throw new Error("Tracker was not initialized");W.reachGoal(e)}var K=function(){function e(){Object(O.a)(this,e)}return Object(x.a)(e,null,[{key:"fetchUserData",value:function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",w.get("user",{Model:_}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"allowNotifications",value:function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return H("allow-notifications"),e.abrupt("return",w.patch("user",{notificationsStatus:Q.ALLOW},{Model:_}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"blockNotifications",value:function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return H("block-notifications"),e.abrupt("return",w.patch("user",{notificationsStatus:Q.BLOCK},{Model:_}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"requestNotifications",value:function(){var t=Object(d.a)(l.a.mark((function t(){var n;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.areNotificationsEnabledOnVkSide){t.next=2;break}return t.abrupt("return",e.allowNotifications());case 2:return t.prev=2,t.next=5,s.a.send("VKWebAppAllowNotifications");case 5:if(n=t.sent,!n.result){t.next=9;break}return t.abrupt("return",e.allowNotifications());case 9:t.next=16;break;case 11:if(t.prev=11,t.t0=t.catch(2),"client_error"!==t.t0.error_type||!t.t0.error_data||4!==t.t0.error_data.error_code||"User denied"!==t.t0.error_data.error_reason){t.next=15;break}return t.abrupt("return",e.blockNotifications());case 15:throw t.t0;case 16:case"end":return t.stop()}}),t,null,[[2,11]])})));return function(){return t.apply(this,arguments)}}()}]),e}();K.areNotificationsEnabledOnVkSide=Boolean(parseInt(z.getSearchParam("vk_are_notifications_enabled"),10));n(350);var V=n(379),J=(n(351),n(8)),Y=function(e){Object(g.a)(n,e);var t=Object(S.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return n}(A({id:M,question:E.a.String,answerWords:E.a.list(E.a.String),correctAnswer:E.a.union([F,E.a.String]),selectedAnswer:E.a.union([F,E.a.String]),isCorrect:E.a.Boolean},"Question")),$=E.a.union([Y,E.a.Number]);$.dispatch=function(e){return"number"===typeof e?E.a.Number:Y};var X=function(e){Object(g.a)(n,e);var t=Object(S.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return n}(A({id:M,questions:E.a.list($),points:E.a.Number},"Game")),Z=function(){function e(){Object(O.a)(this,e)}return Object(x.a)(e,null,[{key:"startBattle",value:function(){var e=Object(d.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",w.post("game",{type:t},{expand:"questions",Model:X}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"submitQuestion",value:function(){var e=Object(d.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",w.patch("question/".concat(t.id),{selectedAnswer:t.selectedAnswer},{Model:Y}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getBattle",value:function(){var e=Object(d.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",w.get("game/".concat(t),{expand:"questions",Model:X}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),ee=n(49),te=n.n(ee),ne=n(77),re=n.n(ne),ae=n(73),ce=n.n(ae),ie=n(97),oe=n.n(ie),se=n(177),ue=n.n(se),le=n(44),de=n(176),je=n.n(de),be=n(175),fe=n.n(be);var pe=function(){return Object(J.x)()===J.k?Object(r.jsx)(fe.a,{}):Object(r.jsx)(je.a,{})};function he(e){var t=e.panelHeaderProps,n=e.onBackButtonClick,a=e.text,c=e.showBackButton,i=Object(le.a)({},t);return i.left=c?Object(r.jsx)(J.o,{onClick:n,children:Object(r.jsx)(pe,{})}):void 0,Object(r.jsx)(J.n,Object(le.a)(Object(le.a)({},i),{},{children:a}))}he.defaultProps={panelHeaderProps:{},showBackButton:!0,onBackButtonClick:function(){}};var Oe=n(24),xe=n.n(Oe);function ve(e){var t=e.delay,n=e.render,r=Object(a.useState)(!1),c=Object(j.a)(r,2),i=c[0],o=c[1];return Object(a.useEffect)((function(){var e=setTimeout((function(){o(!0)}),t);return function(){clearTimeout(e)}}),[t]),i?n():null}ve.propTypes={delay:xe.a.number,render:xe.a.func},ve.defaultProps={delay:200,render:function(){return Object(r.jsx)(J.p,{size:"large"})}};var me=ve,ke=function(e){var t=e.onStartBattle,n=e.user,c=e.onUpdateUser,i=Object(a.useState)(!1),o=Object(j.a)(i,2),s=o[0],u=o[1],b=function(){var e=Object(d.a)(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.target.checked,u(!0),e.prev=2,!n){e.next=9;break}return e.next=6,K.requestNotifications();case 6:r=e.sent,e.next=12;break;case 9:return e.next=11,K.blockNotifications();case 11:r=e.sent;case 12:c(r);case 13:return e.prev=13,u(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[2,,13,16]])})));return function(t){return e.apply(this,arguments)}}();return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(he,{text:"English Clash",showBackButton:!1}),n&&Object(r.jsx)(re.a,{children:Object(r.jsx)(ce.a,{before:n.photoUrl?Object(r.jsx)(ue.a,{src:n.photoUrl}):null,description:Object(r.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[Object(r.jsxs)("span",{children:["\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043e\u0447\u043a\u043e\u0432 - ",n.score]})," ",Object(r.jsxs)("span",{children:["\u041c\u0435\u0441\u0442\u043e \u0432 \u0440\u0435\u0439\u0442\u0438\u043d\u0433\u0435: ",n.foreverRank]})]}),multiline:!0,children:"".concat(n.firstName," ").concat(n.lastName)})}),Object(r.jsx)(re.a,{children:Object(r.jsx)(oe.a,{children:Object(r.jsx)(te.a,{size:"xl",onClick:t,disabled:s,children:"\u041d\u0430\u0447\u0430\u0442\u044c!"})})}),n&&Object(r.jsx)(re.a,{children:Object(r.jsx)(ce.a,{multiline:!0,indicator:Object(r.jsx)(J.r,{checked:n.notificationsStatus===Q.ALLOW,onChange:b,disabled:s}),children:"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f \u043e\u0431 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f\u0445"})}),s&&Object(r.jsx)(me,{})]})};ke.defaultProps={user:null};var ye,we=ke,ge=(n(368),n(178)),Se=function(){function e(){Object(O.a)(this,e)}return Object(x.a)(e,null,[{key:"createFullPictureUrl",value:function(t){var n=e.removePrecedingSlash(t);return w.createFullUrl(n)}},{key:"removePrecedingSlash",value:function(e){return e.startsWith("/")?e.slice(1):e}}]),e}(),Ne=(ye={},Object(N.a)(ye,R,(function(e){return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)("p",{children:["\u0421\u043b\u043e\u0432\u043e \u043d\u0430 \u0430\u043d\u0433\u043b\u0438\u0439\u0441\u043a\u043e\u043c: ",e]}),Object(r.jsx)("p",{children:"\u0412\u044b\u0431\u0435\u0440\u0438 \u0435\u0433\u043e \u043f\u0435\u0440\u0435\u0432\u043e\u0434 \u043d\u0430 \u0440\u0443\u0441\u0441\u043a\u0438\u0439:"})]})})),Object(N.a)(ye,L,(function(e){return Object(r.jsxs)("div",{className:"picture-question",children:[Object(r.jsx)("img",{src:Se.createFullPictureUrl(e),alt:"\u041a\u0430\u0440\u0442\u0438\u043d\u043a\u0430 \u0441 \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u043c"}),Object(r.jsx)("span",{children:"\u042d\u0442\u043e -"})]})})),ye);var Be=function(e){var t=e.question,n=e.gameType,a=e.onSelectAnswer,c=t.answerWords,i=t.selectedAnswer,o=t.isCorrect,s=t.correctAnswer,u=t.question,l=Ne[n];return Object(r.jsxs)(oe.a,{children:[Object(r.jsx)(J.i,{children:l(u)}),c.map((function(e){var t=e===s,n=!o&&e===i,c=Object(ge.a)("answer-button",{correct:t,failure:n});return Object(r.jsx)(te.a,{size:"xl",mode:"primary",stretched:!0,className:c,onClick:function(){return!i&&a(e)},children:e},e)}))]})},Te=n(129),Ce="setBattle",Ee="updateQuestion",Ue="goToNextQuestion",Pe={battle:null,activeQuestion:null,hasNextQuestion:!1};function Ae(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Pe,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Ce:var n=t.payload,r=n.questions;return Object(le.a)(Object(le.a)({},e),{},{battle:n,activeQuestion:r[0],hasNextQuestion:r.length>1});case Ee:var a=t.payload,c=e.battle.questions,i=c.findIndex((function(e){return e.id===a.id})),o=[].concat(Object(Te.a)(c.slice(0,i)),[a],Object(Te.a)(c.slice(i+1)));return Object(le.a)(Object(le.a)({},e),{},{battle:Object(le.a)(Object(le.a)({},e.battle),{},{questions:o}),activeQuestion:a});case Ue:var s=e.battle.questions,u=s.findIndex((function(t){return t.id===e.activeQuestion.id}));if(u===s.length-1)throw new Error("\u0412\u044b \u0443\u0436\u0435 \u043d\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u043c \u0432\u043e\u043f\u0440\u043e\u0441\u0435");var l=u+1;return Object(le.a)(Object(le.a)({},e),{},{activeQuestion:s[l],hasNextQuestion:l<s.length-1});default:return e}}var Fe=function(e){var t=e.onGoBack,n=e.onFinishGame,c=e.gameType,i=void 0===c?null:c,o=Object(a.useState)(!1),s=Object(j.a)(o,2),u=s[0],b=s[1],f=Object(a.useReducer)(Ae,Pe),p=Object(j.a)(f,2),h=p[0],O=p[1],x=h.battle,v=h.activeQuestion,m=h.hasNextQuestion;Object(a.useEffect)((function(){i&&function(){var e=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b(!0),e.prev=1,e.next=4,Z.startBattle(i);case 4:t=e.sent,O({type:Ce,payload:t});case 6:return e.prev=6,b(!1),e.finish(6);case 9:case"end":return e.stop()}}),e,null,[[1,,6,9]])})));return function(){return e.apply(this,arguments)}}()()}),[i]);var k=function(){var e=Object(d.a)(l.a.mark((function e(t){var r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!u){e.next=2;break}return e.abrupt("return");case 2:return r=v.set("selectedAnswer",t),b(!0),e.prev=4,e.next=7,Z.submitQuestion(r);case 7:a=e.sent,O({type:Ee,payload:a});case 9:return e.prev=9,b(!1),e.finish(9);case 12:return e.next=14,z.waitForTimeout(1e3);case 14:m?O({type:Ue}):n(x);case 15:case"end":return e.stop()}}),e,null,[[4,,9,12]])})));return function(t){return e.apply(this,arguments)}}();return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(he,{onBackButtonClick:t,text:"\u0418\u0433\u0440\u0430"}),v&&Object(r.jsx)(Be,{question:v,onSelectAnswer:k,gameType:i}),u&&Object(r.jsx)(me,{})]})},qe=n(99),Me=n.n(qe),Qe=n(181),Re=n.n(Qe),Le=(n(369),n(179)),_e=n.n(Le),ze=n(180),Ge=n.n(ze),De=n(383);function We(e){var t=e.user,n=e.onGoBack,c=e.battle,i=e.onRetry,o=e.onUpdateUser,s=c.questions,u=c.points,b=s.filter((function(e){return e.isCorrect})).length,f=s.length-b,p=Object(a.useState)(!1),h=Object(j.a)(p,2),O=h[0],x=h[1],v=Object(a.useState)(!1),m=Object(j.a)(v,2),k=m[0],y=m[1],w=t.notificationsStatus===Q.TO_BE_REQUESTED,g=Object(r.jsxs)("div",{className:"action-buttons-wrapper",children:[Object(r.jsx)(te.a,{onClick:n,size:"l",before:Object(r.jsx)(_e.a,{}),children:"\u0414\u043e\u043c\u043e\u0439"}),Object(r.jsx)(te.a,{onClick:i,size:"l",before:Object(r.jsx)(Ge.a,{}),children:"\u0415\u0449\u0435 \u0440\u0430\u0437"})]});function S(){return(S=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!k){e.next=2;break}return e.abrupt("return");case 2:return y(!0),e.prev=3,e.next=6,K.requestNotifications();case 6:t=e.sent,o(t),t.notificationsStatus===Q.BLOCK&&x(!0);case 9:return e.prev=9,y(!1),e.finish(9);case 12:case"end":return e.stop()}}),e,null,[[3,,9,12]])})))).apply(this,arguments)}function N(){return B.apply(this,arguments)}function B(){return(B=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!k){e.next=2;break}return e.abrupt("return");case 2:return y(!0),e.prev=3,e.t0=o,e.next=7,K.blockNotifications();case 7:e.t1=e.sent,(0,e.t0)(e.t1),x(!0);case 10:return e.prev=10,y(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[3,,10,13]])})))).apply(this,arguments)}var T=Object(r.jsx)(J.d,{style:{marginTop:"10px"},children:Object(r.jsx)(J.c,{size:"l",style:{padding:"10px"},children:Object(r.jsxs)("div",{className:"notification-request-content",children:[Object(r.jsx)("span",{className:"notification-request-header",children:"\u0423\u0437\u043d\u0430\u0439 \u043f\u0435\u0440\u0432\u044b\u043c \u043e\u0431 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f\u0445 - \u043f\u043e\u0434\u043f\u0438\u0448\u0438\u0441\u044c \u043d\u0430 \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f!"}),Object(r.jsxs)("div",{className:"notification-buttons-wrapper",children:[Object(r.jsx)(te.a,{size:"m",mode:"commerce",className:"notification-button",onClick:function(){return S.apply(this,arguments)},disabled:k,children:"\u041f\u043e\u0434\u043f\u0438\u0441\u0430\u0442\u044c\u0441\u044f"}),Object(r.jsx)(te.a,{size:"m",mode:"secondary",className:"notification-button",onClick:N,disabled:k,children:"\u041d\u0435 \u0441\u0435\u0439\u0447\u0430\u0441"})]}),Object(r.jsx)("span",{className:"notification-request-close",children:Object(r.jsx)(De.a,{onClick:N})}),Object(r.jsx)("span",{className:"notification-request-subtext",children:"\u0412\u0441\u0435\u0433\u0434\u0430 \u043c\u043e\u0436\u043d\u043e \u043e\u0442\u043f\u0438\u0441\u0430\u0442\u044c\u0441\u044f \u043d\u0430 \u0433\u043b\u0430\u0432\u043d\u043e\u043c \u044d\u043a\u0440\u0430\u043d\u0435"})]})})});return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(he,{text:"\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b",onBackButtonClick:n}),Object(r.jsxs)(re.a,{header:Object(r.jsx)(Re.a,{mode:"secondary",children:"\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430"}),children:[Object(r.jsx)(ce.a,{indicator:Object(r.jsx)(Me.a,{mode:"primary",children:b}),children:"\u0412\u0435\u0440\u043d\u044b\u0445 \u043e\u0442\u0432\u0435\u0442\u043e\u0432:"}),Object(r.jsx)(ce.a,{indicator:Object(r.jsx)(Me.a,{mode:"primary",children:f}),children:"\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0445 \u043e\u0442\u0432\u0435\u0442\u043e\u0432:"}),Object(r.jsx)(ce.a,{indicator:Object(r.jsx)(Me.a,{mode:"primary",children:u}),children:"\u041f\u043e\u043b\u0443\u0447\u0435\u043d\u043e \u043e\u0447\u043a\u043e\u0432:"})]}),!w&&g,w&&T,O&&Object(r.jsx)(J.f,{className:"subscribe-later",children:"\u041f\u043e\u0434\u043f\u0438\u0441\u0430\u0442\u044c\u0441\u044f \u043c\u043e\u0436\u043d\u043e \u043d\u0430 \u0433\u043b\u0430\u0432\u043d\u043e\u043c \u044d\u043a\u0440\u0430\u043d\u0435"}),k&&Object(r.jsx)(me,{})]})}We.defaultProps={user:null,battle:null};var Ie=We,He=n(385),Ke=n(386),Ve=function(e){Object(g.a)(n,e);var t=Object(S.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return n}(A({id:M,firstName:E.a.String,lastName:E.a.String,photoUrl:E.a.String,score:q},"ScoreboardUser"));n(371);var Je=function(e){var t=e.rank,n=e.score,a=e.photoUrl,c=e.firstName,i=e.lastName;return Object(r.jsx)(J.q,{before:Object(r.jsx)(J.e,{children:t}),after:n,children:Object(r.jsxs)("div",{className:"scoreboard-item",children:[Object(r.jsx)(J.a,{size:40,src:a}),Object(r.jsxs)("div",{className:"scoreboard-item-name",children:[c," ",i]})]})})},Ye="forever",$e="monthly";function Xe(e){var t=e.user,n=Object(a.useState)([]),c=Object(j.a)(n,2),i=c[0],o=c[1],s=Object(a.useState)(!1),u=Object(j.a)(s,2),b=u[0],f=u[1],p=Object(a.useState)(Ye),h=Object(j.a)(p,2),O=h[0],x=h[1],v=Object(a.useState)(!1),m=Object(j.a)(v,2),k=m[0],y=m[1];return Object(a.useEffect)((function(){(function(){var e=Object(d.a)(l.a.mark((function e(){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o([]),f(!0),e.next=4,w.get("".concat(O,"_scoreboard"));case 4:n=e.sent,r=Ve.fromObject(t),y(Boolean(n.find((function(e){return e.id===r.id})))),o(n),f(!1);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[O,t]),Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(he,{text:"\u0420\u0435\u0439\u0442\u0438\u043d\u0433",showBackButton:!1}),Object(r.jsx)(J.h,{vertical:"top",children:Object(r.jsxs)(J.u,{children:[Object(r.jsx)(J.v,{selected:O===Ye,onClick:function(){return x(Ye)},children:"\u0417\u0430 \u0432\u0441\u0435 \u0432\u0440\u0435\u043c\u044f"}),Object(r.jsx)(J.v,{selected:O===$e,onClick:function(){return x($e)},children:"\u0417\u0430 \u043c\u0435\u0441\u044f\u0446"})]})}),Object(r.jsx)(J.f,{children:Object(r.jsxs)(J.i,{style:{paddingTop:"20px"},children:[!b&&Object(r.jsxs)(J.l,{children:[i.map((function(e,t){var n=e.id,a=e.firstName,c=e.lastName,i=e.photoUrl,o=e.score;return Object(r.jsx)(Je,{rank:t+1,score:o,photoUrl:i,firstName:a,lastName:c},n)})),!k&&Object(r.jsx)(Je,{rank:O===Ye?t.foreverRank:t.monthlyRank,score:t.score,photoUrl:t.photoUrl,firstName:t.firstName,lastName:t.lastName})]}),b&&Object(r.jsx)(me,{})]})})]})}Xe.defaultProps={user:null};var Ze=Xe;n(372);var et=function(e){var t=e.onGoBack,n=e.onChoose;return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(he,{text:"\u0422\u0438\u043f \u0438\u0433\u0440\u044b",onBackButtonClick:t}),Object(r.jsxs)(J.f,{children:[Object(r.jsx)(J.j,{mode:"primary",children:"\u0412\u044b\u0431\u0435\u0440\u0438 \u0442\u0438\u043f \u0438\u0433\u0440\u044b:"}),Object(r.jsxs)("div",{className:"choose-game-type-body",children:[Object(r.jsx)(J.b,{size:"l",onClick:function(){return n(L)},children:"\u041a\u0430\u0440\u0442\u0438\u043d\u043a\u0430"}),Object(r.jsx)(J.b,{size:"l",onClick:function(){return n(R)},children:"\u041f\u0435\u0440\u0435\u0432\u043e\u0434"})]})]})]})},tt=function(){var e=Object(a.useState)(null),t=Object(j.a)(e,2),n=t[0],c=t[1],i=Object(a.useState)(Object(r.jsx)(f.a,{})),o=Object(j.a)(i,2),s=o[0],u=o[1],b=Object(a.useState)("game"),p=Object(j.a)(b,2),O=p[0],x=p[1],v=Object(a.useState)("home"),m=Object(j.a)(v,2),k=m[0],y=m[1],w=Object(a.useState)(null),g=Object(j.a)(w,2),S=g[0],N=g[1],B=Object(a.useState)(null),T=Object(j.a)(B,2),C=T[0],E=T[1];function U(e){return P.apply(this,arguments)}function P(){return(P=Object(d.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,K.fetchUserData();case 3:if(n=e.sent,c(n),!t){e.next=12;break}if(n.notificationsStatus!==Q.ALLOW||K.areNotificationsEnabledOnVkSide){e.next=12;break}return e.t0=c,e.next=10,K.blockNotifications();case 10:e.t1=e.sent,(0,e.t0)(e.t1);case 12:return e.prev=12,u(null),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[0,,12,15]])})))).apply(this,arguments)}Object(a.useEffect)((function(){z.isProductionMode&&V.a({dsn:"https://ae49049c58d94887bed337d523675ca6@o158161.ingest.sentry.io/5554359",beforeSend:function(e,t){if(e.exception){var n=t&&t.originalException&&t.originalException instanceof Error&&t.originalException.message?t.originalException.message:"";u(Object(r.jsxs)(h.a,{actions:[{mode:"default",title:"\u041e\u041a",autoclose:!0}],onClose:function(){return u(null)},children:[Object(r.jsx)("h2",{children:"\u0412\u043e\u0437\u043d\u0438\u043a\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430 =("}),n&&Object(r.jsx)("p",{className:"error-message",children:n}),Object(r.jsx)("p",{children:"\u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439 \u0435\u0449\u0435 \u0440\u0430\u0437"})]}))}return e}}),I||(W.init(),I=!0)}),[]),Object(a.useEffect)((function(){U(!0)}),[]);var A=function(){var e=Object(d.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z.getBattle(t.id);case 2:n=e.sent,N(n),y("results"),H("finish-game"),U(!1);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),F=function(){return y("home")},q=function(){y("choose-game-type")},M=function(e){e&&E(e),y("battle"),H("start-game")};return Object(r.jsxs)(J.g,{activeStory:O,tabbar:Object(r.jsxs)(J.s,{children:[Object(r.jsx)(J.t,{text:"\u0413\u043b\u0430\u0432\u043d\u0430\u044f",selected:"game"===O,onClick:function(){x("game"),y("home")},children:Object(r.jsx)(He.a,{})}),Object(r.jsx)(J.t,{text:"\u0420\u0435\u0439\u0442\u0438\u043d\u0433",selected:"scoreboard"===O,onClick:function(){x("scoreboard"),y("scoreboard-home")},children:Object(r.jsx)(Ke.a,{})})]}),children:[Object(r.jsxs)(J.w,{id:"game",activePanel:k,popout:s,children:[Object(r.jsx)(J.m,{id:"home",children:Object(r.jsx)(we,{user:n,onStartBattle:q,onUpdateUser:function(e){return c(e)}})}),Object(r.jsx)(J.m,{id:"choose-game-type",children:Object(r.jsx)(et,{onGoBack:F,onChoose:M})}),Object(r.jsx)(J.m,{id:"battle",children:Object(r.jsx)(Fe,{onGoBack:q,onFinishGame:A,gameType:C})}),Object(r.jsx)(J.m,{id:"results",children:Object(r.jsx)(Ie,{user:n,onRetry:function(){return M(null)},onGoBack:F,battle:S,onUpdateUser:function(e){return c(e)}})})]}),Object(r.jsx)(J.w,{id:"scoreboard",activePanel:k,popout:s,children:Object(r.jsx)(J.m,{id:"scoreboard-home",children:Object(r.jsx)(Ze,{user:n})})})]})},nt=n(387);function rt(e){var t=e.children;return z.isProductionMode?Object(r.jsx)(nt.a,{fallback:function(e){var t=e.error,n=e.componentStack,a=e.resetError;return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)("div",{children:"\u041e\u0448\u0438\u0431\u043a\u0430 \u043e\u0442\u0440\u0438\u0441\u043e\u0432\u043a\u0438:"}),Object(r.jsx)("p",{children:t.message}),Object(r.jsx)("p",{children:n}),Object(r.jsx)(te.a,{onClick:a,children:"\u041f\u043e\u043f\u0440\u043e\u0431\u043e\u0432\u0430\u0442\u044c \u0435\u0449\u0435 \u0440\u0430\u0437"})]})},children:t}):t}s.a.send("VKWebAppInit"),s.a.subscribe((function(e){var t=e.detail,n=t.type,r=t.data;if("VKWebAppUpdateConfig"===n){var a=document.createAttribute("scheme");a.value=r.scheme||"client_light",document.body.attributes.setNamedItem(a)}})),Object(i.render)(Object(r.jsx)(c.a.StrictMode,{children:Object(r.jsx)(rt,{children:Object(r.jsx)(tt,{})})}),document.getElementById("root")),z.isProductionMode||Promise.all([n.e(3),n.e(4)]).then(n.bind(null,391))}},[[377,1,2]]]);
//# sourceMappingURL=main.ea1d052a.chunk.js.map