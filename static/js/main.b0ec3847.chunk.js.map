{"version":3,"sources":["Utils.ts","core/ApiService.ts","core/model-utils.ts","core/tcomb-types.ts","constants.ts","core/user-model.ts","core/trackers/tracker-utils.ts","core/trackers/MetrikaTracker.ts","core/trackers/PosthogTracker.ts","core/trackers/LocalTracker.ts","core/trackers/VkPixelTracker.ts","core/trackers/trackers.ts","components/AppService.ts","models/question-model.ts","models/game-model.ts","components/panels/BattleService.ts","components/helpers/BackButton.tsx","components/helpers/PanelHeader.tsx","components/helpers/Loader.tsx","components/panels/Home.tsx","components/QuestionService.ts","components/Question.tsx","components/panels/battle-reducer.ts","components/panels/Battle.tsx","components/panels/Results.tsx","models/scoreboard-user-model.ts","components/panels/ScoreboardItem.tsx","components/panels/ScoreboardHome.tsx","components/panels/ChooseGameType.tsx","components/App.tsx","components/ErrorBoundary.tsx","index.tsx"],"names":["Utils","time","Promise","res","setTimeout","name","URLSearchParams","window","location","search","get","isProductionMode","process","ApiService","url","data","sendToken","expand","Model","send","convertDataToBackendFormat","method","urlParams","expandString","castArray","join","append","options","headers","createHeaders","mode","body","JSON","stringify","timeout","fetch","createFullApiURL","response","processResponse","Accept","Authorization","getAuthorizationHeader","getSearchParam","Error","getFakeVKIDAuthHeader","getQueryStringAuthHeader","queryString","slice","fakeVkID","relativeUrl","queryParams","createFullUrl","domain","removeTrailingSlash","String","status","json","ok","detail","convertDataToFrontendFormat","toSnake","camelCased","toCamel","fromObject","endsWith","getFromObject","object","fromJSON","set","key","value","this","constructor","update","$set","createModel","attributes","defaultProps","struct","prototype","Null","irreducible","PositiveNumber","refinement","tcomb","Number","n","ID","NOTIFICATIONS_STATUSES","ALLOW","BLOCK","TO_BE_REQUESTED","GAME_TYPES","User","id","vkId","firstName","lastName","photoUrl","score","monthlyScore","foreverRank","monthlyRank","notificationsStatus","enums","of","Object","values","createTracker","tracker","AUTOMATIC_OPERATIONS","METRIKA_ID","MetrikaTracker","init","m","e","t","r","i","k","a","push","arguments","l","Date","createElement","getElementsByTagName","async","src","parentNode","insertBefore","document","ym","clickmap","trackLinks","accurateTrackBounce","webvisor","console","log","warn","identify","UserID","reachGoal","params","initPromise","waitForInit","PosthogTracker","posthog","autocapture","loaded","people","capture","LocalTracker","VkPixelTracker","vkOpenApiScript","type","onload","VK","Retargeting","Init","Hit","head","appendChild","Goal","registeredTrackers","call","args","forEach","includes","trackers","AppService","patch","areNotificationsEnabledOnVkSide","allowNotifications","bridge","result","error_type","error_data","error_code","error_reason","blockNotifications","Boolean","parseInt","Question","question","answerWords","list","correctAnswer","union","selectedAnswer","isCorrect","expandableQuestion","dispatch","x","Game","questions","points","BattleService","gameType","post","gameDefinition","BackButton","platform","IOS","PanelHeader","panelHeaderProps","onBackButtonClick","text","showBackButton","vkPanelHeaderProps","left","onClick","undefined","Loader","delay","render","useState","pastDelay","setPastDelay","useEffect","timerId","clearTimeout","propTypes","PropTypes","number","func","size","Home","onStartBattle","user","onUpdateUser","loading","setLoading","onSwitchNotifications","event","newChecked","target","checked","requestNotifications","updatedUser","before","description","style","display","flexDirection","multiline","disabled","indicator","onChange","QuestionService","relativeUrlWithoutSlash","removePrecedingSlash","startsWith","renderQuestionMap","questionWord","imagePath","className","createFullPictureUrl","alt","onSelectAnswer","questionString","renderQuestion","map","answer","isCorrectAnswer","isFailure","classes","clsx","correct","failure","stretched","battleActions","initialState","battle","activeQuestion","hasNextQuestion","battleReducer","state","action","payload","length","updatedQuestion","currentQuestions","questionIndex","findIndex","activeQuestionIndex","newQuestionIndex","Battle","onGoBack","onFinishGame","useReducer","startSinglePlayerGame","fetchedGame","startBattle","questionToSubmit","submitQuestion","questionWithAnswerData","waitForTimeout","Results","onRetry","correctAnswersNumber","filter","incorrectAnswersNumber","rejectedNotifications","setRejectedNotifications","showNotificationsRequest","navigationButtons","notificationRequest","marginTop","padding","header","ScoreboardUser","ScoreboardItem","rank","after","SCOREBOARD_TYPES","ScoreboardHome","usersList","setUsersList","activeTab","setActiveTab","currentUserInScoreboard","setCurrentUserInScoreboard","users","currentScoreboardUser","find","fetchData","vertical","selected","paddingTop","index","ChooseGameType","onChoose","App","setUser","popout","setPopout","activeStory","setActiveStory","activePanel","setActivePanel","setBattle","setGameType","fetchUser","isInitialRequest","fetchUserData","fetchedUser","Sentry","dsn","beforeSend","hint","exception","errorMessage","originalException","message","actions","title","autoclose","onClose","localBattle","getBattle","updatedBattle","goToHomePanel","goToChooseGameTypePanel","chosenGameType","tabbar","ErrorBoundary","children","fallback","error","componentStack","resetError","subscribe","schemeAttribute","createAttribute","scheme","setNamedItem","renderReact","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.b0ec3847.chunk.js","sourcesContent":["export class Utils {\n  static isProductionMode = process.env.NODE_ENV === 'production'\n\n  static async waitForTimeout(time: number): Promise<void> {\n    await new Promise((res) => setTimeout(res, time))\n  }\n\n  static getSearchParam(name: string): string {\n    const urlParams = new URLSearchParams(window.location.search)\n    return urlParams.get(name)\n  }\n}\n","import { timeout } from 'promise-timeout'\nimport { toCamel, toSnake } from 'convert-keys'\nimport castArray from 'lodash.castarray'\nimport { ModelType } from './model-utils'\nimport { Utils } from '../Utils'\n\nconst API_HOST = process.env.REACT_APP_API_HOST\n\ntype Data = Record<string, unknown>\n\nexport class ApiService {\n  static async post<T>(\n    url: string,\n    data: Data,\n    { sendToken = true, expand = '', Model = null } = {}\n  ): Promise<T> {\n    return ApiService.send<T>(url, {\n      data: ApiService.convertDataToBackendFormat(data),\n      sendToken,\n      method: 'POST',\n      expand,\n      Model,\n    })\n  }\n\n  static async patch<T>(\n    url: string,\n    data: Data,\n    { sendToken = true, expand = '', Model = null } = {}\n  ): Promise<T> {\n    return ApiService.send<T>(url, {\n      data: ApiService.convertDataToBackendFormat(data),\n      sendToken,\n      method: 'PATCH',\n      expand,\n      Model,\n    })\n  }\n\n  static async get<T>(\n    url: string,\n    { expand = '', Model = null } = {}\n  ): Promise<T> {\n    return ApiService.send<T>(url, {\n      sendToken: true,\n      method: 'GET',\n      expand,\n      Model,\n    })\n  }\n\n  static async send<T>(\n    url: string,\n    {\n      data,\n      sendToken,\n      method,\n      expand,\n      Model = null,\n    }: {\n      data?: Data\n      sendToken: boolean\n      method: string\n      expand?: string\n      Model?: ModelType<unknown>\n    }\n  ): Promise<T> {\n    const urlParams = new URLSearchParams()\n    if (expand) {\n      const expandString = castArray(expand).join(',')\n      urlParams.append('expand', expandString)\n    }\n    const options: RequestInit = {\n      headers: ApiService.createHeaders({ sendToken }),\n    }\n    if (method !== 'GET') {\n      options.mode = 'cors'\n      options.body = JSON.stringify(data)\n    }\n    options.method = method\n    const response = await timeout(\n      fetch(ApiService.createFullApiURL(url, urlParams), options),\n      10000\n    )\n    return ApiService.processResponse<T>(response, Model)\n  }\n\n  static createHeaders({\n    sendToken,\n  }: { sendToken?: boolean } = {}): HeadersInit {\n    const headers: HeadersInit = {\n      Accept: 'application/json',\n      'Content-Type': 'application/json',\n    }\n    if (sendToken) {\n      headers.Authorization = ApiService.getAuthorizationHeader()\n    }\n    return headers\n  }\n\n  static getAuthorizationHeader(): string {\n    if (Utils.getSearchParam('fake_vk_id')) {\n      if (Utils.isProductionMode)\n        throw new Error('You cannot use fake_vk_id in production')\n      return ApiService.getFakeVKIDAuthHeader()\n    }\n    return ApiService.getQueryStringAuthHeader()\n  }\n\n  static getQueryStringAuthHeader(): string {\n    const queryString = window.location.search.slice(1)\n    return `QueryString ${queryString}`\n  }\n\n  static getFakeVKIDAuthHeader(): string {\n    const fakeVkID = Utils.getSearchParam('fake_vk_id')\n    return `FakeVKID ${fakeVkID}`\n  }\n\n  static createFullApiURL(\n    relativeUrl: string,\n    queryParams?: URLSearchParams\n  ): string {\n    return ApiService.createFullUrl(`api/${relativeUrl}`, queryParams)\n  }\n\n  static createFullUrl(\n    relativeUrl: string,\n    queryParams?: URLSearchParams\n  ): string {\n    const domain = ApiService.removeTrailingSlash(API_HOST)\n    let url = `${domain}/${relativeUrl}`\n    if (queryParams && String(queryParams)) {\n      url += `?${String(queryParams)}`\n    }\n    return url\n  }\n\n  static async processResponse<T>(\n    response: Response,\n    Model: ModelType<unknown> = null\n  ): Promise<T> {\n    if (response.status >= 500 && response.status < 600) {\n      throw new Error('Внутренняя ошибка сервера')\n    }\n    let json: {\n      detail?: string\n    }\n    try {\n      json = await response.json()\n    } catch (e) {\n      throw new Error('Неверный ответ сервера')\n    }\n    if (!response.ok) {\n      if (json.detail) {\n        throw new Error(json.detail)\n      }\n      throw new Error('Неизвестная ошибка приложения')\n    }\n    return ApiService.convertDataToFrontendFormat<T>(json, Model)\n  }\n\n  static convertDataToBackendFormat(data: Data): Data {\n    return toSnake(data)\n  }\n\n  static convertDataToFrontendFormat<T>(data: Data, Model = null): T {\n    const camelCased: T = toCamel(data)\n    if (Model) {\n      return Model.fromObject(camelCased)\n    }\n    return camelCased\n  }\n\n  static removeTrailingSlash(url: string): string {\n    return url.endsWith('/') ? url.slice(0, -1) : url\n  }\n}\n","import fromJSON from 'tcomb/lib/fromJSON'\nimport { Struct, struct, StructProps } from 'tcomb'\n\nfunction getFromObject<T>(Model: ModelType<T>) {\n  return function fromObject(object: Record<string, unknown>) {\n    return fromJSON<T>(object, Model)\n  }\n}\n\nfunction set(key: string, value: unknown) {\n  return this.constructor.update(this, {\n    [key]: {\n      $set: value,\n    },\n  })\n}\n\nexport interface ModelType<T> extends Struct<T> {\n  fromObject(object: Record<string, unknown>): T\n}\n\nexport interface ModelInstance {\n  set(key: string, value: unknown): this\n}\n\nexport function createModel<T>(\n  attributes: StructProps,\n  name: string,\n  defaultProps = {}\n): ModelType<T> {\n  // @ts-ignore\n  const Model: ModelType<T> = struct(attributes, {\n    name,\n    defaultProps,\n  })\n\n  Model.fromObject = getFromObject<T>(Model)\n  Model.prototype.set = set\n\n  return Model\n}\n\nexport function extendModel<T>(\n  baseClass: ModelType<Record<string, unknown>>,\n  props: StructProps,\n  name: string\n): ModelType<T> {\n  // @ts-ignore\n  const Model: ModelType<T> = baseClass.extend(props, name)\n\n  Model.fromObject = getFromObject<T>(Model)\n  Model.prototype.set = set\n\n  return Model\n}\n","import tcomb, { irreducible, refinement } from 'tcomb'\n\nexport const Null = irreducible('Null', (value) => value === null)\n\nexport const PositiveNumber = refinement(\n  tcomb.Number,\n  (n) => n >= 0,\n  'PositiveNumber'\n)\n\nexport const ID = refinement(tcomb.Number, (n) => n >= 1, 'ID')\n","export const NOTIFICATIONS_STATUSES = {\n  ALLOW: 'allow',\n  BLOCK: 'block',\n  TO_BE_REQUESTED: 'to be requested',\n}\n\nexport const GAME_TYPES = {\n  WORD: 'word',\n  PICTURE: 'picture',\n}\n","import { createModel, ModelInstance } from './model-utils'\nimport tcomb from 'tcomb'\nimport { ID, PositiveNumber } from './tcomb-types'\nimport { NOTIFICATIONS_STATUSES } from '../constants'\n\nconst attributes = {\n  id: ID,\n  vkId: ID,\n  firstName: tcomb.String,\n  lastName: tcomb.String,\n  photoUrl: tcomb.String,\n  score: PositiveNumber,\n  monthlyScore: PositiveNumber,\n  foreverRank: PositiveNumber,\n  monthlyRank: PositiveNumber,\n  notificationsStatus: tcomb.enums.of(\n    Object.values(NOTIFICATIONS_STATUSES),\n    'notificationsStatus'\n  ),\n}\n\nexport interface UserInstance extends ModelInstance {\n  id: number\n  vkId: number\n  firstName: string\n  lastName: string\n  photoUrl: string\n  score: number\n  monthlyScore: number\n  foreverRank: number\n  monthlyRank: number\n  notificationsStatus: 'allow' | 'block' | 'to be requested'\n}\n\nexport class User extends createModel<UserInstance>(attributes, 'User') {}\n","export interface TrackerInterface {\n  AUTOMATIC_OPERATIONS: Array<string>\n  init: () => Promise<void>\n  identify: (id: number, vkId: number) => Promise<void>\n  reachGoal: (name: string, params?: Record<string, unknown>) => Promise<void>\n}\n\ntype Optional<T, K extends keyof T> = Pick<Partial<T>, K> & Omit<T, K>\n\ntype TrackerInput = Optional<TrackerInterface, 'AUTOMATIC_OPERATIONS'>\n\nexport const createTracker = (tracker: TrackerInput): TrackerInterface => ({\n  AUTOMATIC_OPERATIONS: ['*'],\n  ...tracker,\n})\n","import { createTracker, TrackerInterface } from './tracker-utils'\n\nconst METRIKA_ID = process.env.REACT_APP_METRIKA_ID\n\nexport const MetrikaTracker: TrackerInterface = createTracker({\n  async init(): Promise<void> {\n    /* eslint-disable */\n    ;(function(m, e, t, r, i, k, a) {\n      m[i] =\n        m[i] ||\n        function() {\n          ;(m[i].a = m[i].a || []).push(arguments)\n        }\n      // @ts-ignore\n      m[i].l = 1 * new Date()\n      ;(k = e.createElement(t)),\n        (a = e.getElementsByTagName(t)[0]),\n        (k.async = 1),\n        (k.src = r),\n        a.parentNode.insertBefore(k, a)\n    })(window, document, 'script', 'https://mc.yandex.ru/metrika/tag.js', 'ym')\n\n    try {\n      // @ts-ignore\n      ym(METRIKA_ID, 'init', {\n        clickmap: true,\n        trackLinks: true,\n        accurateTrackBounce: true,\n        webvisor: true,\n      })\n    } catch (e) {\n      console.log('Seems like Yandex metrika is blocked')\n      console.warn(e)\n    }\n    /* eslint-enable */\n  },\n\n  async identify(id: number, vkId: number): Promise<void> {\n    try {\n      // @ts-ignore\n      window.ym(METRIKA_ID, 'userParams', {\n        UserID: id,\n        vkId,\n      })\n    } catch (e) {\n      // eslint-disable-next-line no-console\n      console.log('Seems like Yandex metrika is blocked')\n      // eslint-disable-next-line no-console\n      console.warn(e)\n    }\n  },\n\n  reachGoal(name: string, params?: Record<string, unknown>): Promise<void> {\n    return new Promise((res) => {\n      try {\n        // @ts-ignore\n        window.ym(METRIKA_ID, 'reachGoal', name, params, () => res())\n      } catch (e) {\n        // eslint-disable-next-line no-console\n        console.log('Seems like Yandex metrika is blocked')\n        // eslint-disable-next-line no-console\n        console.warn(e)\n      }\n    })\n  },\n})\n","import posthog from 'posthog-js'\nimport { timeout } from 'promise-timeout'\nimport { createTracker, TrackerInterface } from './tracker-utils'\n\nlet initPromise = null\n\nasync function waitForInit(): Promise<void> {\n  if (initPromise === null) {\n    throw new Error('Tracker was not initialized')\n  }\n  await initPromise\n}\n\nexport const PosthogTracker: TrackerInterface = createTracker({\n  init(): Promise<void> {\n    initPromise = new Promise<void>((res) => {\n      posthog.init(process.env.REACT_APP_POSTHOG_ID, {\n        autocapture: false,\n        loaded: () => res(),\n      })\n    })\n    return timeout<void>(initPromise, 10000)\n  },\n\n  async identify(id: number, vkId: number): Promise<void> {\n    await waitForInit()\n    posthog.identify(String(id))\n    posthog.people.set({ vkId })\n  },\n\n  async reachGoal(\n    name: string,\n    params?: Record<string, unknown>\n  ): Promise<void> {\n    await waitForInit()\n    posthog.capture(name, params)\n  },\n})\n","/* eslint-disable no-console */\nimport { createTracker, TrackerInterface } from './tracker-utils'\n\nexport const LocalTracker: TrackerInterface = createTracker({\n  async init(): Promise<void> {\n    console.log('Init tracker')\n  },\n\n  async identify(id: number, vkId: number): Promise<void> {\n    console.log(`linked session with userId ${id}, vkId ${vkId}`)\n  },\n\n  async reachGoal(\n    name: string,\n    params?: Record<string, unknown>\n  ): Promise<void> {\n    console.log(`Reach goal ${name} with params`, params)\n  },\n})\n","import { Utils } from '../../Utils'\n\nexport const VkPixelTracker = {\n  AUTOMATIC_OPERATIONS: ['init'],\n\n  init(): void {\n    const vkOpenApiScript = document.createElement('script')\n    vkOpenApiScript.type = 'application/javascript'\n    vkOpenApiScript.async = true\n    vkOpenApiScript.src = 'https://vk.com/js/api/openapi.js?168'\n    vkOpenApiScript.onload = () => {\n      // @ts-ignore\n      window.VK.Retargeting.Init(process.env.REACT_APP_VK_PIXEL_ID)\n      // @ts-ignore\n      window.VK.Retargeting.Hit()\n    }\n    document.head.appendChild(vkOpenApiScript)\n  },\n\n  reachGoal(name: string): void {\n    if (Utils.isProductionMode) {\n      // @ts-ignore\n      window.VK.Goal(name)\n    }\n  },\n}\n","import { Utils } from '../../Utils'\nimport { MetrikaTracker } from './MetrikaTracker'\nimport { PosthogTracker } from './PosthogTracker'\nimport { LocalTracker } from './LocalTracker'\nimport { VkPixelTracker } from './VkPixelTracker'\n\nconst registeredTrackers = Utils.isProductionMode\n  ? [MetrikaTracker, PosthogTracker, VkPixelTracker]\n  : [LocalTracker]\n\nfunction call(method: string, ...args: Array<unknown>) {\n  registeredTrackers.forEach((tracker) => {\n    if (\n      tracker.AUTOMATIC_OPERATIONS[0] === '*' ||\n      tracker.AUTOMATIC_OPERATIONS.includes(method)\n    )\n      tracker[method](...args)\n  })\n}\n\nexport const trackers = {\n  identify(id: number, vkId: number): void {\n    call('identify', id, vkId)\n  },\n\n  init(): void {\n    call('init')\n  },\n\n  reachGoal(name: string, params?: Record<string, unknown>): void {\n    call('reachGoal', name, params)\n  },\n}\n","import { ApiService } from '../core/ApiService'\nimport { User, UserInstance } from '../core/user-model'\nimport { NOTIFICATIONS_STATUSES } from '../constants'\nimport bridge from '@vkontakte/vk-bridge'\nimport { Utils } from '../Utils'\nimport { trackers } from '../core/trackers/trackers'\n\nexport class AppService {\n  static areNotificationsEnabledOnVkSide = Boolean(\n    parseInt(Utils.getSearchParam('vk_are_notifications_enabled'), 10)\n  )\n\n  static async fetchUserData(): Promise<UserInstance> {\n    return ApiService.get<UserInstance>('user', { Model: User })\n  }\n\n  static async allowNotifications(): Promise<UserInstance> {\n    trackers.reachGoal('allow-notifications')\n    return ApiService.patch<UserInstance>(\n      'user',\n      { notificationsStatus: NOTIFICATIONS_STATUSES.ALLOW },\n      { Model: User }\n    )\n  }\n\n  static async blockNotifications(): Promise<UserInstance> {\n    trackers.reachGoal('block-notifications')\n    return ApiService.patch<UserInstance>(\n      'user',\n      { notificationsStatus: NOTIFICATIONS_STATUSES.BLOCK },\n      { Model: User }\n    )\n  }\n\n  static async requestNotifications(): Promise<UserInstance> {\n    if (AppService.areNotificationsEnabledOnVkSide) {\n      // already allowed in VK, need only to allow on our backend\n      return AppService.allowNotifications()\n    }\n    try {\n      const { result } = await bridge.send('VKWebAppAllowNotifications')\n      if (result) return AppService.allowNotifications()\n    } catch (e) {\n      // rejected\n      if (\n        e.error_type === 'client_error' &&\n        e.error_data &&\n        e.error_data.error_code === 4 &&\n        e.error_data.error_reason === 'User denied'\n      )\n        return AppService.blockNotifications()\n      throw e\n    }\n  }\n}\n","import { createModel, ModelInstance } from '../core/model-utils'\nimport tcomb from 'tcomb'\nimport { ID, Null } from '../core/tcomb-types'\n\nconst attributes = {\n  id: ID,\n  question: tcomb.String,\n  answerWords: tcomb.list(tcomb.String),\n  correctAnswer: tcomb.union([Null, tcomb.String]),\n  selectedAnswer: tcomb.union([Null, tcomb.String]),\n  isCorrect: tcomb.Boolean,\n}\n\nexport interface QuestionInstance extends ModelInstance {\n  id: number\n  question: string\n  answerWords: string[]\n  correctAnswer: null | string\n  selectedAnswer: null | string\n  isCorrect: boolean\n}\n\nexport class Question extends createModel<QuestionInstance>(\n  attributes,\n  'Question'\n) {}\n","import { createModel, ModelInstance } from '../core/model-utils'\nimport tcomb from 'tcomb'\nimport { Question, QuestionInstance } from './question-model'\nimport { ID } from '../core/tcomb-types'\n\nconst expandableQuestion = tcomb.union([Question, tcomb.Number])\nexpandableQuestion.dispatch = (x) => {\n  if (typeof x === 'number') return tcomb.Number\n  return Question\n}\n\nconst attributes = {\n  id: ID,\n  questions: tcomb.list(expandableQuestion),\n  points: tcomb.Number,\n}\n\nexport interface GameInstance extends ModelInstance {\n  id: number\n  questions: QuestionInstance[]\n  points: number\n}\n\nexport class Game extends createModel<GameInstance>(attributes, 'Game') {}\n","import { ApiService } from '../../core/ApiService'\nimport { Game, GameInstance } from '../../models/game-model'\nimport { Question, QuestionInstance } from '../../models/question-model'\nimport { GameDefinitionInstance } from '../../models/game-definition-model'\n\nexport class BattleService {\n  static async startSinglePlayerGame(gameType: string): Promise<GameInstance> {\n    const gameDefinition = await ApiService.post<GameDefinitionInstance>(\n      'game_definition',\n      {\n        type: gameType,\n      }\n    )\n    return ApiService.post<GameInstance>(\n      'game',\n      { gameDefinition: gameDefinition.id },\n      { expand: 'questions', Model: Game }\n    )\n  }\n\n  static async submitQuestion(\n    question: QuestionInstance\n  ): Promise<QuestionInstance> {\n    return ApiService.patch(\n      `question/${question.id}`,\n      {\n        selectedAnswer: question.selectedAnswer,\n      },\n      { Model: Question }\n    )\n  }\n\n  static async getBattle(id: number): Promise<GameInstance> {\n    return ApiService.get(`game/${id}`, { expand: 'questions', Model: Game })\n  }\n}\n","import React from 'react'\nimport { IOS, platform } from '@vkontakte/vkui/'\nimport Icon24Back from '@vkontakte/icons/dist/24/back'\nimport Icon28ChevronBack from '@vkontakte/icons/dist/28/chevron_back'\n\nfunction BackButton(): JSX.Element {\n  const osName = platform()\n  if (osName === IOS) return <Icon28ChevronBack />\n  return <Icon24Back />\n}\n\nexport default BackButton\n","import React from 'react'\nimport PropTypes, { InferProps } from 'prop-types'\nimport {\n  PanelHeaderButton,\n  PanelHeader as VKPanelHeader,\n} from '@vkontakte/vkui'\nimport BackButton from './BackButton'\n\nexport default function PanelHeader({\n  panelHeaderProps,\n  onBackButtonClick,\n  text,\n  showBackButton,\n}: InferProps<typeof PanelHeader.propTypes>): JSX.Element {\n  const vkPanelHeaderProps = { ...panelHeaderProps }\n  if (showBackButton)\n    vkPanelHeaderProps.left = (\n      <PanelHeaderButton onClick={onBackButtonClick}>\n        <BackButton />\n      </PanelHeaderButton>\n    )\n  else vkPanelHeaderProps.left = undefined\n  return <VKPanelHeader {...vkPanelHeaderProps}>{text}</VKPanelHeader>\n}\n\nPanelHeader.propTypes = {\n  onBackButtonClick: PropTypes.func,\n  text: PropTypes.string.isRequired,\n  panelHeaderProps: PropTypes.shape({\n    left: PropTypes.node,\n  }),\n  showBackButton: PropTypes.bool,\n}\n\nPanelHeader.defaultProps = {\n  panelHeaderProps: {},\n  showBackButton: true,\n  onBackButtonClick: () => {},\n}\n","import React, { useEffect, useState } from 'react'\nimport PropTypes, { InferProps } from 'prop-types'\nimport { PanelSpinner } from '@vkontakte/vkui'\n\nfunction Loader({\n  delay,\n  render,\n}: InferProps<typeof Loader.propTypes>): JSX.Element {\n  const [pastDelay, setPastDelay] = useState(false)\n  useEffect(() => {\n    const timerId = setTimeout(() => {\n      setPastDelay(true)\n    }, delay)\n    return () => {\n      clearTimeout(timerId)\n    }\n  }, [delay])\n\n  if (pastDelay) return render()\n  return null\n}\n\nLoader.propTypes = {\n  delay: PropTypes.number,\n  render: PropTypes.func,\n}\n\nLoader.defaultProps = {\n  delay: 200,\n  render: () => <PanelSpinner size=\"large\" />,\n}\n\nexport default Loader\n","import React, { useState } from 'react'\nimport PropTypes, { InferProps } from 'prop-types'\nimport Button from '@vkontakte/vkui/dist/components/Button/Button'\nimport Group from '@vkontakte/vkui/dist/components/Group/Group'\nimport Cell from '@vkontakte/vkui/dist/components/Cell/Cell'\nimport Div from '@vkontakte/vkui/dist/components/Div/Div'\nimport Avatar from '@vkontakte/vkui/dist/components/Avatar/Avatar'\nimport PanelHeader from '../helpers/PanelHeader'\nimport { Switch } from '@vkontakte/vkui'\nimport { AppService } from '../AppService'\nimport { UserInstance } from '../../core/user-model'\nimport Loader from '../helpers/Loader'\nimport { NOTIFICATIONS_STATUSES } from '../../constants'\n\nconst Home = ({\n  onStartBattle,\n  user,\n  onUpdateUser,\n}: InferProps<typeof Home.propTypes>): JSX.Element => {\n  const [loading, setLoading] = useState(false)\n\n  const onSwitchNotifications = async (event) => {\n    const { checked: newChecked } = event.target\n    setLoading(true)\n    try {\n      let updatedUser: UserInstance\n      if (newChecked) {\n        // need to enable\n        updatedUser = await AppService.requestNotifications()\n      } else {\n        // need to disable\n        updatedUser = await AppService.blockNotifications()\n      }\n      onUpdateUser(updatedUser)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <>\n      <PanelHeader text=\"English Clash\" showBackButton={false} />\n      {user && (\n        <Group>\n          <Cell\n            before={user.photoUrl ? <Avatar src={user.photoUrl} /> : null}\n            description={\n              <div style={{ display: 'flex', flexDirection: 'column' }}>\n                <span>Количество очков - {user.score}</span>{' '}\n                <span>Место в рейтинге: {user.foreverRank}</span>\n              </div>\n            }\n            multiline\n          >\n            {`${user.firstName} ${user.lastName}`}\n          </Cell>\n        </Group>\n      )}\n\n      <Group>\n        <Div>\n          <Button size=\"xl\" onClick={onStartBattle} disabled={loading}>\n            Начать!\n          </Button>\n        </Div>\n      </Group>\n\n      {user && (\n        <Group>\n          <Cell\n            multiline\n            indicator={\n              <Switch\n                checked={\n                  user.notificationsStatus === NOTIFICATIONS_STATUSES.ALLOW\n                }\n                onChange={onSwitchNotifications}\n                disabled={loading}\n              />\n            }\n          >\n            Уведомления об обновлениях\n          </Cell>\n        </Group>\n      )}\n      {loading && <Loader />}\n    </>\n  )\n}\n\nHome.propTypes = {\n  onStartBattle: PropTypes.func.isRequired,\n  user: PropTypes.shape({\n    photoUrl: PropTypes.string.isRequired,\n    firstName: PropTypes.string.isRequired,\n    lastName: PropTypes.string.isRequired,\n    score: PropTypes.number.isRequired,\n    foreverRank: PropTypes.number.isRequired,\n    monthlyRank: PropTypes.number.isRequired,\n    notificationsStatus: PropTypes.string.isRequired,\n  }),\n  onUpdateUser: PropTypes.func.isRequired,\n}\n\nHome.defaultProps = {\n  user: null,\n}\n\nexport default Home\n","import { ApiService } from '../core/ApiService'\n\nexport class QuestionService {\n  static createFullPictureUrl(relativeUrl: string): string {\n    const relativeUrlWithoutSlash = QuestionService.removePrecedingSlash(\n      relativeUrl\n    )\n    return ApiService.createFullUrl(relativeUrlWithoutSlash)\n  }\n\n  static removePrecedingSlash(url: string): string {\n    return url.startsWith('/') ? url.slice(1) : url\n  }\n}\n","import React from 'react'\nimport Div from '@vkontakte/vkui/dist/components/Div/Div'\nimport Button from '@vkontakte/vkui/dist/components/Button/Button'\nimport './Question.css'\nimport clsx from 'clsx'\nimport { QuestionInstance } from '../models/question-model'\nimport { GAME_TYPES } from '../constants'\nimport { QuestionService } from './QuestionService'\nimport { Group } from '@vkontakte/vkui'\n\ninterface Props {\n  question: QuestionInstance\n  gameType: string\n  onSelectAnswer(answer: string)\n}\n\nconst renderQuestionMap = {\n  [GAME_TYPES.WORD]: (questionWord: string) => (\n    <>\n      <p>Слово на английском: {questionWord}</p>\n      <p>Выбери его перевод на русский:</p>\n    </>\n  ),\n  [GAME_TYPES.PICTURE]: (imagePath: string) => (\n    <div className=\"picture-question\">\n      <img\n        src={QuestionService.createFullPictureUrl(imagePath)}\n        alt=\"Картинка с вопросом\"\n      />\n      <span>Это -</span>\n    </div>\n  ),\n}\n\nfunction Question({ question, gameType, onSelectAnswer }: Props): JSX.Element {\n  const {\n    answerWords,\n    selectedAnswer,\n    isCorrect,\n    correctAnswer,\n    question: questionString,\n  } = question\n  const renderQuestion = renderQuestionMap[gameType]\n  return (\n    <Div>\n      <Group>{renderQuestion(questionString)}</Group>\n      {answerWords.map((answer) => {\n        const isCorrectAnswer = answer === correctAnswer\n        const isFailure = !isCorrect && answer === selectedAnswer\n        const classes = clsx('answer-button', {\n          correct: isCorrectAnswer,\n          failure: isFailure,\n        })\n        return (\n          <Button\n            key={answer}\n            size=\"xl\"\n            mode=\"primary\"\n            stretched\n            className={classes}\n            onClick={() => !selectedAnswer && onSelectAnswer(answer)}\n          >\n            {answer}\n          </Button>\n        )\n      })}\n    </Div>\n  )\n}\n\nexport default Question\n","import { GameInstance } from '../../models/game-model'\nimport { QuestionInstance } from '../../models/question-model'\n\nexport const battleActions = {\n  setBattle: 'setBattle',\n  updateQuestion: 'updateQuestion',\n  goToNextQuestion: 'goToNextQuestion',\n}\n\nexport const initialState = {\n  battle: null,\n  activeQuestion: null,\n  hasNextQuestion: false,\n}\n\nexport function battleReducer(\n  state = initialState,\n  action: {\n    type: string\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    payload?: any\n  }\n): {\n  battle: null | GameInstance\n  activeQuestion: null | QuestionInstance\n  hasNextQuestion: boolean\n} {\n  switch (action.type) {\n    case battleActions.setBattle: {\n      const battle = action.payload\n      const { questions } = battle\n      return {\n        ...state,\n        battle,\n        activeQuestion: questions[0],\n        hasNextQuestion: questions.length > 1,\n      }\n    }\n    case battleActions.updateQuestion: {\n      const updatedQuestion = action.payload\n      const currentQuestions = state.battle.questions\n      const questionIndex = currentQuestions.findIndex(\n        ({ id }) => id === updatedQuestion.id\n      )\n      const questions = [\n        ...currentQuestions.slice(0, questionIndex),\n        updatedQuestion,\n        ...currentQuestions.slice(questionIndex + 1),\n      ]\n      return {\n        ...state,\n        battle: {\n          ...state.battle,\n          questions,\n        },\n        activeQuestion: updatedQuestion,\n      }\n    }\n    case battleActions.goToNextQuestion: {\n      const currentQuestions = state.battle.questions\n      const activeQuestionIndex = currentQuestions.findIndex(\n        ({ id }) => id === state.activeQuestion.id\n      )\n      if (activeQuestionIndex === currentQuestions.length - 1) {\n        throw new Error('Вы уже на последнем вопросе')\n      }\n      const newQuestionIndex = activeQuestionIndex + 1\n      return {\n        ...state,\n        activeQuestion: currentQuestions[newQuestionIndex],\n        hasNextQuestion: newQuestionIndex < currentQuestions.length - 1,\n      }\n    }\n    default:\n      return state\n  }\n}\n","import React, { useEffect, useReducer, useState } from 'react'\nimport PanelHeader from '../helpers/PanelHeader'\nimport { BattleService } from './BattleService'\nimport Question from '../Question'\nimport { Utils } from '../../Utils'\nimport { battleActions, battleReducer, initialState } from './battle-reducer'\nimport Loader from '../helpers/Loader'\nimport { GameInstance } from '../../models/game-model'\n\nconst WAIT_TIME_TO_SHOW_CORRECT_ANSWER = 1000\n\ninterface PropTypes {\n  gameType?: string\n  onGoBack()\n  onFinishGame(game: GameInstance)\n}\n\nconst Battle = ({\n  onGoBack,\n  onFinishGame,\n  gameType = null,\n}: PropTypes): JSX.Element => {\n  const [loading, setLoading] = useState(false)\n  const [state, dispatch] = useReducer(battleReducer, initialState)\n  const { battle, activeQuestion, hasNextQuestion } = state\n\n  useEffect(() => {\n    const startBattle = async () => {\n      setLoading(true)\n      try {\n        const fetchedGame = await BattleService.startSinglePlayerGame(gameType)\n        dispatch({\n          type: battleActions.setBattle,\n          payload: fetchedGame,\n        })\n      } finally {\n        setLoading(false)\n      }\n    }\n    if (gameType) startBattle()\n  }, [gameType])\n\n  const onSelectAnswer = async (answer: string) => {\n    if (loading) return\n    const questionToSubmit = activeQuestion.set('selectedAnswer', answer)\n    setLoading(true)\n    try {\n      const questionWithAnswerData = await BattleService.submitQuestion(\n        questionToSubmit\n      )\n      dispatch({\n        type: battleActions.updateQuestion,\n        payload: questionWithAnswerData,\n      })\n    } finally {\n      setLoading(false)\n    }\n\n    await Utils.waitForTimeout(WAIT_TIME_TO_SHOW_CORRECT_ANSWER)\n\n    if (hasNextQuestion) dispatch({ type: battleActions.goToNextQuestion })\n    else onFinishGame(battle)\n  }\n\n  return (\n    <>\n      <PanelHeader onBackButtonClick={onGoBack} text=\"Игра\" />\n      {activeQuestion && (\n        <Question\n          question={activeQuestion}\n          onSelectAnswer={onSelectAnswer}\n          gameType={gameType}\n        />\n      )}\n      {loading && <Loader />}\n    </>\n  )\n}\n\nexport default Battle\n","import React, { useState } from 'react'\nimport PropTypes, { InferProps } from 'prop-types'\nimport PanelHeader from '../helpers/PanelHeader'\nimport Cell from '@vkontakte/vkui/dist/components/Cell/Cell'\nimport Counter from '@vkontakte/vkui/dist/components/Counter/Counter'\nimport Group from '@vkontakte/vkui/dist/components/Group/Group'\nimport Header from '@vkontakte/vkui/dist/components/Header/Header'\nimport Button from '@vkontakte/vkui/dist/components/Button/Button'\nimport './Results.css'\nimport Icon24Home from '@vkontakte/icons/dist/24/home'\nimport Icon24Replay from '@vkontakte/icons/dist/24/replay'\nimport { NOTIFICATIONS_STATUSES } from '../../constants'\nimport { AppService } from '../AppService'\nimport { Card, CardGrid, Div } from '@vkontakte/vkui'\nimport Loader from '../helpers/Loader'\nimport { Icon24Cancel } from '@vkontakte/icons'\n\nfunction Results({\n  user,\n  onGoBack,\n  battle,\n  onRetry,\n  onUpdateUser,\n}: InferProps<typeof Results.propTypes>): JSX.Element {\n  const { questions, points } = battle\n  const correctAnswersNumber = questions.filter(({ isCorrect }) => isCorrect)\n    .length\n  const incorrectAnswersNumber = questions.length - correctAnswersNumber\n  const [rejectedNotifications, setRejectedNotifications] = useState(false)\n  const [loading, setLoading] = useState(false)\n\n  const showNotificationsRequest =\n    user.notificationsStatus === NOTIFICATIONS_STATUSES.TO_BE_REQUESTED\n\n  const navigationButtons = (\n    <div className=\"action-buttons-wrapper\">\n      <Button onClick={onGoBack} size=\"l\" before={<Icon24Home />}>\n        Домой\n      </Button>\n      <Button onClick={onRetry} size=\"l\" before={<Icon24Replay />}>\n        Еще раз\n      </Button>\n    </div>\n  )\n\n  async function allowNotifications() {\n    if (loading) return\n    setLoading(true)\n    try {\n      const updatedUser = await AppService.requestNotifications()\n      onUpdateUser(updatedUser)\n      if (updatedUser.notificationsStatus === NOTIFICATIONS_STATUSES.BLOCK) {\n        // if user clicked subscribe, but rejected in VK popup\n        setRejectedNotifications(true)\n      }\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  async function blockNotifications() {\n    if (loading) return\n    setLoading(true)\n    try {\n      onUpdateUser(await AppService.blockNotifications())\n      setRejectedNotifications(true)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const notificationRequest = (\n    <CardGrid style={{ marginTop: '10px' }}>\n      <Card size=\"l\" style={{ padding: '10px' }}>\n        <div className=\"notification-request-content\">\n          <span className=\"notification-request-header\">\n            Узнай первым об обновлениях - подпишись на уведомления!\n          </span>\n          <div className=\"notification-buttons-wrapper\">\n            <Button\n              size=\"m\"\n              mode=\"commerce\"\n              className=\"notification-button\"\n              onClick={allowNotifications}\n              disabled={loading}\n            >\n              Подписаться\n            </Button>\n            <Button\n              size=\"m\"\n              mode=\"secondary\"\n              className=\"notification-button\"\n              onClick={blockNotifications}\n              disabled={loading}\n            >\n              Не сейчас\n            </Button>\n          </div>\n          <span className=\"notification-request-close\">\n            <Icon24Cancel onClick={blockNotifications} />\n          </span>\n          <span className=\"notification-request-subtext\">\n            Всегда можно отписаться на главном экране\n          </span>\n        </div>\n      </Card>\n    </CardGrid>\n  )\n  return (\n    <>\n      <PanelHeader text=\"Результаты\" onBackButtonClick={onGoBack} />\n      <Group header={<Header mode=\"secondary\">Статистика</Header>}>\n        <Cell\n          indicator={<Counter mode=\"primary\">{correctAnswersNumber}</Counter>}\n        >\n          Верных ответов:\n        </Cell>\n        <Cell\n          indicator={<Counter mode=\"primary\">{incorrectAnswersNumber}</Counter>}\n        >\n          Неверных ответов:\n        </Cell>\n        <Cell indicator={<Counter mode=\"primary\">{points}</Counter>}>\n          Получено очков:\n        </Cell>\n      </Group>\n      {!showNotificationsRequest && navigationButtons}\n      {showNotificationsRequest && notificationRequest}\n      {rejectedNotifications && (\n        <Div className=\"subscribe-later\">\n          Подписаться можно на главном экране\n        </Div>\n      )}\n      {loading && <Loader />}\n    </>\n  )\n}\n\nResults.propTypes = {\n  user: PropTypes.shape({\n    photoUrl: PropTypes.string.isRequired,\n    firstName: PropTypes.string.isRequired,\n    lastName: PropTypes.string.isRequired,\n    score: PropTypes.number.isRequired,\n    foreverRank: PropTypes.number.isRequired,\n    monthlyRank: PropTypes.number.isRequired,\n    notificationsStatus: PropTypes.string.isRequired,\n  }),\n  onGoBack: PropTypes.func.isRequired,\n  onRetry: PropTypes.func.isRequired,\n  battle: PropTypes.shape({\n    points: PropTypes.number.isRequired,\n    questions: PropTypes.arrayOf(\n      PropTypes.shape({\n        isCorrect: PropTypes.bool.isRequired,\n      })\n    ).isRequired,\n  }),\n  onUpdateUser: PropTypes.func.isRequired,\n}\n\nResults.defaultProps = {\n  user: null,\n  battle: null,\n}\n\nexport default Results\n","import tcomb from 'tcomb'\nimport { ID, PositiveNumber } from '../core/tcomb-types'\nimport { createModel, ModelInstance } from '../core/model-utils'\n\nconst attributes = {\n  id: ID,\n  firstName: tcomb.String,\n  lastName: tcomb.String,\n  photoUrl: tcomb.String,\n  score: PositiveNumber,\n}\n\nexport interface ScoreboardUserInstance extends ModelInstance {\n  id: number\n  firstName: string\n  lastName: string\n  photoUrl: string\n  score: number\n}\n\nexport class ScoreboardUser extends createModel<ScoreboardUserInstance>(\n  attributes,\n  'ScoreboardUser'\n) {}\n","import React from 'react'\nimport PropTypes, { InferProps } from 'prop-types'\nimport { Avatar, Counter, SimpleCell } from '@vkontakte/vkui'\n\nfunction ScoreboardItem({\n  rank,\n  score,\n  photoUrl,\n  firstName,\n  lastName,\n}: InferProps<typeof ScoreboardItem.propTypes>): JSX.Element {\n  return (\n    <SimpleCell before={<Counter>{rank}</Counter>} after={score}>\n      <div className=\"scoreboard-item\">\n        <Avatar size={40} src={photoUrl} />\n        <div className=\"scoreboard-item-name\">\n          {firstName} {lastName}\n        </div>\n      </div>\n    </SimpleCell>\n  )\n}\n\nScoreboardItem.propTypes = {\n  rank: PropTypes.number.isRequired,\n  score: PropTypes.number.isRequired,\n  photoUrl: PropTypes.string.isRequired,\n  firstName: PropTypes.string.isRequired,\n  lastName: PropTypes.string.isRequired,\n}\n\nexport default ScoreboardItem\n","import React, { useEffect, useState } from 'react'\nimport PanelHeader from '../helpers/PanelHeader'\nimport { ApiService } from '../../core/ApiService'\nimport { Div, FixedLayout, Group, List, Tabs, TabsItem } from '@vkontakte/vkui'\nimport { ScoreboardUser } from '../../models/scoreboard-user-model'\nimport './ScoreboardHome.css'\nimport ScoreboardItem from './ScoreboardItem'\nimport Loader from '../helpers/Loader'\nimport { UserInstance } from '../../core/user-model'\n\nconst SCOREBOARD_TYPES = {\n  forever: 'forever',\n  monthly: 'monthly',\n}\n\ninterface Props {\n  user: UserInstance\n}\n\nfunction ScoreboardHome({ user = null }: Props): JSX.Element {\n  const [usersList, setUsersList] = useState<ScoreboardUser[]>([])\n  const [loading, setLoading] = useState(false)\n  const [activeTab, setActiveTab] = useState(SCOREBOARD_TYPES.forever)\n  const [currentUserInScoreboard, setCurrentUserInScoreboard] = useState(false)\n\n  useEffect(() => {\n    const fetchData = async () => {\n      setUsersList([])\n      setLoading(true)\n      const users = await ApiService.get<ScoreboardUser[]>(\n        `${activeTab}_scoreboard`\n      )\n      const currentScoreboardUser = ScoreboardUser.fromObject({ ...user })\n      setCurrentUserInScoreboard(\n        Boolean(users.find(({ id }) => id === currentScoreboardUser.id))\n      )\n      setUsersList(users)\n      setLoading(false)\n    }\n\n    fetchData()\n  }, [activeTab, user])\n\n  return (\n    <>\n      <PanelHeader text=\"Рейтинг\" showBackButton={false} />\n      <FixedLayout vertical=\"top\">\n        <Tabs>\n          <TabsItem\n            selected={activeTab === SCOREBOARD_TYPES.forever}\n            onClick={() => setActiveTab(SCOREBOARD_TYPES.forever)}\n          >\n            За все время\n          </TabsItem>\n          <TabsItem\n            selected={activeTab === SCOREBOARD_TYPES.monthly}\n            onClick={() => setActiveTab(SCOREBOARD_TYPES.monthly)}\n          >\n            За месяц\n          </TabsItem>\n        </Tabs>\n      </FixedLayout>\n      <Div>\n        <Group style={{ paddingTop: '20px' }}>\n          {!loading && (\n            <List>\n              {usersList.map(\n                ({ id, firstName, lastName, photoUrl, score }, index) => (\n                  <ScoreboardItem\n                    rank={index + 1}\n                    score={score}\n                    photoUrl={photoUrl}\n                    firstName={firstName}\n                    lastName={lastName}\n                    key={id}\n                  />\n                )\n              )}\n              {!currentUserInScoreboard && (\n                <ScoreboardItem\n                  rank={\n                    activeTab === SCOREBOARD_TYPES.forever\n                      ? user.foreverRank\n                      : user.monthlyRank\n                  }\n                  score={\n                    activeTab === SCOREBOARD_TYPES.forever\n                      ? user.score\n                      : user.monthlyScore\n                  }\n                  photoUrl={user.photoUrl}\n                  firstName={user.firstName}\n                  lastName={user.lastName}\n                />\n              )}\n            </List>\n          )}\n          {loading && <Loader />}\n        </Group>\n      </Div>\n    </>\n  )\n}\n\nexport default ScoreboardHome\n","import React from 'react'\nimport PanelHeader from '../helpers/PanelHeader'\nimport { Button, Div, Header } from '@vkontakte/vkui'\nimport { GAME_TYPES } from '../../constants'\nimport './ChooseGameType.css'\n\ninterface Props {\n  onGoBack(): void\n  onChoose(type: string): void\n}\n\nfunction ChooseGameType({ onGoBack, onChoose }: Props): JSX.Element {\n  return (\n    <>\n      <PanelHeader text=\"Тип игры\" onBackButtonClick={onGoBack} />\n      <Div>\n        <Header mode=\"primary\">Выбери тип игры:</Header>\n        <div className=\"choose-game-type-body\">\n          <Button size=\"l\" onClick={() => onChoose(GAME_TYPES.PICTURE)}>\n            Картинка\n          </Button>\n          <Button size=\"l\" onClick={() => onChoose(GAME_TYPES.WORD)}>\n            Перевод\n          </Button>\n        </div>\n      </Div>\n    </>\n  )\n}\n\nexport default ChooseGameType\n","import React, { useEffect, useState } from 'react'\nimport ScreenSpinner from '@vkontakte/vkui/dist/components/ScreenSpinner/ScreenSpinner'\nimport Alert from '@vkontakte/vkui/dist/components/Alert/Alert'\nimport '@vkontakte/vkui/dist/vkui.css'\nimport { AppService } from './AppService'\nimport './constant-styles.css'\nimport { Utils } from '../Utils'\nimport * as Sentry from '@sentry/react'\nimport './App.css'\nimport { trackers } from '../core/trackers/trackers'\nimport { Epic, Panel, Tabbar, TabbarItem, View } from '@vkontakte/vkui'\nimport { GameInstance } from '../models/game-model'\nimport { BattleService } from './panels/BattleService'\nimport Home from './panels/Home'\nimport Battle from './panels/Battle'\nimport Results from './panels/Results'\nimport { Icon28HomeOutline, Icon28UsersOutline } from '@vkontakte/icons'\nimport ScoreboardHome from './panels/ScoreboardHome'\nimport { NOTIFICATIONS_STATUSES } from '../constants'\nimport { UserInstance } from '../core/user-model'\nimport ChooseGameType from './panels/ChooseGameType'\nimport { VkPixelTracker } from '../core/trackers/VkPixelTracker'\n\nconst App = (): JSX.Element => {\n  const [user, setUser] = useState<UserInstance>(null)\n  const [popout, setPopout] = useState(<ScreenSpinner />)\n  const [activeStory, setActiveStory] = useState('game')\n  const [activePanel, setActivePanel] = useState('home')\n  const [battle, setBattle] = useState(null)\n  const [gameType, setGameType] = useState<string>(null)\n\n  useEffect(() => {\n    if (Utils.isProductionMode) {\n      Sentry.init({\n        dsn: process.env.REACT_APP_SENTRY_DSN,\n        beforeSend(event, hint) {\n          if (event.exception) {\n            const errorMessage =\n              hint &&\n              hint.originalException &&\n              hint.originalException instanceof Error &&\n              hint.originalException.message\n                ? hint.originalException.message\n                : ''\n            setPopout(\n              <Alert\n                actions={[\n                  {\n                    mode: 'default',\n                    title: 'ОК',\n                    autoclose: true,\n                  },\n                ]}\n                onClose={() => setPopout(null)}\n              >\n                <h2>Возникла ошибка =(</h2>\n                {errorMessage && (\n                  <p className=\"error-message\">{errorMessage}</p>\n                )}\n                <p>Попробуй еще раз</p>\n              </Alert>\n            )\n          }\n          return event\n        },\n      })\n    }\n    trackers.init()\n  }, [])\n\n  async function fetchUser(isInitialRequest: boolean) {\n    try {\n      const fetchedUser = await AppService.fetchUserData()\n      setUser(fetchedUser)\n      if (isInitialRequest) {\n        if (\n          fetchedUser.notificationsStatus === NOTIFICATIONS_STATUSES.ALLOW &&\n          !AppService.areNotificationsEnabledOnVkSide\n        ) {\n          setUser(await AppService.blockNotifications())\n        }\n      }\n      trackers.identify(fetchedUser.id, fetchedUser.vkId)\n    } finally {\n      setPopout(null)\n    }\n  }\n\n  useEffect(() => {\n    fetchUser(true)\n  }, [])\n\n  const onFinishGame = async (localBattle: GameInstance) => {\n    const updatedBattle = await BattleService.getBattle(localBattle.id)\n    setBattle(updatedBattle)\n    setActivePanel('results')\n    trackers.reachGoal('finish-game')\n    VkPixelTracker.reachGoal('conversion')\n    fetchUser(false)\n  }\n\n  const goToHomePanel = () => setActivePanel('home')\n\n  const goToChooseGameTypePanel = () => {\n    setActivePanel('choose-game-type')\n  }\n\n  const onStartBattle = (chosenGameType: string) => {\n    if (chosenGameType !== gameType) setGameType(chosenGameType)\n    setActivePanel('battle')\n    trackers.reachGoal('start-game', { type: chosenGameType })\n  }\n\n  const onOpenScoreboard = () => {\n    setActiveStory('scoreboard')\n    setActivePanel('scoreboard-home')\n  }\n\n  return (\n    <Epic\n      activeStory={activeStory}\n      tabbar={\n        <Tabbar>\n          <TabbarItem\n            text=\"Главная\"\n            selected={activeStory === 'game'}\n            onClick={() => {\n              setActiveStory('game')\n              setActivePanel('home')\n            }}\n          >\n            <Icon28HomeOutline />\n          </TabbarItem>\n          <TabbarItem\n            text=\"Рейтинг\"\n            selected={activeStory === 'scoreboard'}\n            onClick={onOpenScoreboard}\n          >\n            <Icon28UsersOutline />\n          </TabbarItem>\n        </Tabbar>\n      }\n    >\n      <View id=\"game\" activePanel={activePanel} popout={popout}>\n        <Panel id=\"home\">\n          <Home\n            user={user}\n            onStartBattle={goToChooseGameTypePanel}\n            onUpdateUser={(updatedUser) => setUser(updatedUser)}\n          />\n        </Panel>\n        <Panel id=\"choose-game-type\">\n          <ChooseGameType onGoBack={goToHomePanel} onChoose={onStartBattle} />\n        </Panel>\n        <Panel id=\"battle\">\n          <Battle\n            onGoBack={goToChooseGameTypePanel}\n            onFinishGame={onFinishGame}\n            gameType={gameType}\n          />\n        </Panel>\n        <Panel id=\"results\">\n          <Results\n            user={user}\n            onRetry={() => onStartBattle(gameType)}\n            onGoBack={goToHomePanel}\n            battle={battle}\n            onUpdateUser={(updatedUser) => setUser(updatedUser)}\n          />\n        </Panel>\n      </View>\n      <View id=\"scoreboard\" activePanel={activePanel} popout={popout}>\n        <Panel id=\"scoreboard-home\">\n          <ScoreboardHome user={user} />\n        </Panel>\n      </View>\n    </Epic>\n  )\n}\n\nexport default App\n","import React from 'react'\nimport PropTypes, { InferProps } from 'prop-types'\nimport * as Sentry from '@sentry/react'\nimport Button from '@vkontakte/vkui/dist/components/Button/Button'\nimport { Utils } from '../Utils'\n\n/**\n * Component catches only errors in rendering phase and lifecycle\n * Error in click and async handlers need to be caught and rendered separately\n */\nexport function ErrorBoundary({\n  children,\n}: InferProps<typeof ErrorBoundary.propTypes>): JSX.Element {\n  if (!Utils.isProductionMode) return children\n\n  return (\n    <Sentry.ErrorBoundary\n      fallback={({ error, componentStack, resetError }) => (\n        <>\n          <div>Ошибка отрисовки:</div>\n          <p>{error.message}</p>\n          <p>{componentStack}</p>\n          <Button onClick={resetError}>Попробовать еще раз</Button>\n        </>\n      )}\n    >\n      {children}\n    </Sentry.ErrorBoundary>\n  )\n}\n\nErrorBoundary.propTypes = {\n  children: PropTypes.element.isRequired,\n}\n","import 'core-js/features/map'\nimport 'core-js/features/set'\nimport React from 'react'\nimport { render as renderReact } from 'react-dom'\nimport bridge from '@vkontakte/vk-bridge'\nimport App from './components/App'\nimport { Utils } from './Utils'\nimport { ErrorBoundary } from './components/ErrorBoundary'\n\n// Init VK  Mini App\nbridge.send('VKWebAppInit')\n\nbridge.subscribe(({ detail: { type, data } }) => {\n  if (type === 'VKWebAppUpdateConfig') {\n    const schemeAttribute = document.createAttribute('scheme')\n    // @ts-ignore\n    schemeAttribute.value = data.scheme || 'client_light'\n    document.body.attributes.setNamedItem(schemeAttribute)\n  }\n})\n\nfunction render() {\n  renderReact(\n    <React.StrictMode>\n      <ErrorBoundary>\n        <App />\n      </ErrorBoundary>\n    </React.StrictMode>,\n    document.getElementById('root')\n  )\n}\nrender()\n\nif (!Utils.isProductionMode) {\n  if (module.hot) {\n    module.hot.accept('./components/App', render)\n  }\n\n  import('./eruda')\n}\n"],"sourceRoot":""}